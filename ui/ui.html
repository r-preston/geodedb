<!DOCTYPE html>
<html>
<head>
    <title>GeodeDB</title>
    <style>
        *{
            margin:0px;
            padding:0px;
            box-sizing: border-box;
            white-space: nowrap;
            font-family: Georgia, serif;
        }
        #loading-splash{
            width: 100%;
            height:100%;
            position: fixed;
            display: table;
            background-color: white;
            font-size: 30px;
            z-index: 99999999999999999999;
        }
        #loading-splash div{
            display: table-cell;
            vertical-align: middle;
            text-align: center;
        }
        #global-status-bar{
            height: 3%;
            width: 100%;
            bottom: 0px;
            right: 0px;
            padding-left: 0.5em;
            background-color: white;
            border-top: 1px solid #aaaaaa;
            position: absolute;
            font-size: 18px;
            z-index: 99;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
        }
        #global-status-bar:before{
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        #status-wrapper{
            display: inline-block;
            vertical-align: middle;
            text-align: left;
            width: 92%;
        }
        #mass-addition-button{
            display: inline-block;
            vertical-align: bottom;
            padding-top: 0.2%;
            text-align: middle;
            text-decoration: underline;
            cursor: pointer;
            border-left: 1px solid #aaaaaa;
            width: 8%;
            height: 100%;
        }
        .include-object{
            width:100%;
            height:100%;
        }
        span{
            white-space: normal;
        }
        .main-panel{
            position:absolute;
            height:97%;
        }
        .search-panel{
            width:24%;
            box-shadow: 2px 0px 5px #cccccc;
            border-right:1px solid #aaaaaa;
            z-index: 2;
        }
        .results-panel{
            position: absolute;
            width: 45%;
            left: 24%;
        }
        .item-panel{
            background-color:#eeeeee;
            z-index: 999;
            width:31%;
            left:69%;
            box-shadow: -2px 0px 5px #cccccc;
            border-left:1px solid #aaaaaa;
            padding: 1em;
            font-size: 20px;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button{
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="radio"]{
            margin-top:-1px;
            vertical-align:middle;
        }
        .tooltip{
            cursor:pointer;
            text-decoration: none;
            border-bottom: 1px dotted black;
            position: relative;
        }
        .tooltip:hover{
            color: #555555;
        }
        .tooltip .tooltiptext{
            visibility: hidden;
            position: absolute;
            z-index: 1;
            background-color: white;
            border-radius: 5px;
            padding:5px;
            text-align: center;
            width:120px;
            color:#000000;
            top:-5px;
            right: 60px;
            margin-left: 12px;
            opacity: 0;
            font-size: 16px;
            transition: opacity 0.3s;
            transition-delay: 0.2s;
            border: 1px solid #666666;
        }
        .tooltip:hover .tooltiptext{
            visibility: visible;
            opacity: 1;
        }
        #item-view-tooltip{
            left: -20px;
            top: 30px;
            width: 200px;
            background-color: #eeeeee;
        }
        .help-panel{
            position: absolute;
            visibility: hidden;
            opacity: 0;
            width: 70%;
            top: 15%;
            left: 15%;
            background-color: #fafafa;
            border: 0px;
            border-radius: 5px;
            z-index: -3;
            transition: all 0.5s;
            height:0px;
            line-height: 0px;
            white-space: normal;
            overflow-x: hidden;
            overflow-y: overlay;
            padding: 20px 30px;
            word-wrap: break-word;
            font-size: 20px;
        }
        .help-panel h2, .help-panel h3, .help-panel h4, .help-panel h4{
            margin-bottom: 1em;
            margin-top: 1em;
        }
        .show-help-panel{
            visibility: visible;
            z-index: 99999;
            opacity: 1;
            height: 70%;
            line-height: normal;
            border:1px solid #888888;
        }
        button{
            outline:none;
            font-size: 20px;
            font-family: serif;
            cursor:pointer;
            border-style: solid;
            border-width: 1px;
            border-radius: 10px;
            border-color: #888888;
        }
        button:active{
            border-style: inset;
        }
        .green-button{
            background-color: #c8d7a7;
        }
        .green-button:hover{
            background-color: #d3dfb9;
        }
        .green-button:active{
            background-color: #e9efdc;
        }
        .darkgreen-button{
            background-color: #a7c072;
        }
        .darkgreen-button:hover{
            background-color: #acc577;
        }
        .darkgreen-button:active{
            background-color: #d3dfb9;
        }
        .red-button{
            background-color: #ffb2b2;
        }
        .red-button:hover{
            background-color: #ffc0c0;
        }
        .red-button:active{
            background-color: #ffd0d0;
        }
        #search-top-panel-container{
            width:100%;
            height:5.155%; /* 5vh */
            top:0px;
            left:0px;
            position:absolute;
        }
        .search-input-panel{
            height:89.691%; /* 87vh */
            width:100%;
            position:absolute;
            top:5.155%;
            padding:4.583%; /* 1.1vw */
            font-family:serif;
            font-size: 18px;
            overflow: hidden;
        }
        .search-input-panel:hover{
            overflow-y: overlay;
        }
        .dropdown{
            position:absolute;
            left: 0px;
            width: 50%;
            height: 100%;
        }
        #mineral-tab-wrapper{
            left: 50%;
        }
        .table-tab{
            width:100%;
            box-sizing: content-box;
            background-color: #eeeeee;
            color:#999999;
            border:1px solid #aaaaaa;
            border-right:0px;
            height:100%;
            display: inline-block;
            font-size: 22px;
            text-align: center;
        }
        .table-tab:hover{
            background-color: #f4f7ed;
        }
        #mineral-tab{
            left:50%;
            cursor: pointer;
        }
        #collection-tab-text-wrapper{
            display:inline-block;
            width:80%;
            height: 100%;
            position: absolute;
            left: 0px;
            top: 0px;
            cursor: pointer;
        }
        #collection-tab-text-wrapper, #mineral-tab{
            text-align: center;
            white-space: nowrap;
        }
        #collection-tab-text-wrapper:before, #mineral-tab:before{
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        #collection-tab-text, #mineral-tab div{
            display: inline-block;
            vertical-align: middle;
        }
        #dropdown-arrow-container{
            width:20%;
            height:100%;
            display: inline-block;
            text-align: center;
            z-index: 10;
            cursor:pointer;
            position: absolute;
            left: 80%;
            top: 0px;
        }
        #dropdown-arrow-container:hover{
            background-color: #fdfff4;
            box-sizing: border-box;
            border-top: 1px solid #aaaaaa;
        }
        .dropdown-arrow{
            width:100%;
            height:100%;
            padding: 28% 22%;
            transform: scale(1,1);
            transition: transform 0.15s linear;
        }
        .dropdown-arrow-up{
            transform: scale(1,-1);
            transition: transform 0.15s linear;
        }
        .tab-active{
            background-color: #dfe8cc;
            color:black;
        }
        #dropdown-menu{
            position: absolute;
            top: 105%;
        }
        .dropdown-content{
            display:none;
            min-width:100%;
            background-color: #dfe8cc;
            text-align: center;
            font-size: 18px;
            z-index:10;
            white-space: normal;
        }
        .dropdown-content div:not(#dropdown-divider){
            position: relative;
            display: block;
            width:100%;
            cursor:pointer;
            /*min-height:150%; /* 2vw */
            line-height: 185%;
        }
        .dropdown-content div:not(#dropdown-divider):hover{
            background-color: #c8d7a8;
        }
        .show-dropdown{
            display:block;
        }
        .dropdown-active{
            background-color: #748d3f;
            background-color: #4f5b36;
            background-color: #c8d7a8;
        }
        .dropdown-active:hover{
            background-color: #748d3f;
            background-color: #4f5b36;
            background-color: #c8d7a8;
        }
        .search-form{
            height: 94%;
            width: 100%;
            position: relative;
        }
        .input-box{
            position:relative;
            background-color: #eeeeee;
            border:1px inset #aaaaaa;
            color:#333333;
            padding: 2px;
            font-family: serif;
            margin:5px 0px;
            font-size:18px;
            border-radius:2px;
            width:100%;
            height:3.8%; /* 2.8vh */
            margin-bottom: 2%; /* 1vh */
        }
        .oppositeradio table{
            position: relative;
            table-layout: fixed;
            width: 100%;
        }
        .search-heading{
            font-size: 24px;
        }
        .search-top-heading{
            width:80%;
            display:inline-block;
            height:3.2%;
        }
        .input-box:focus, .input-box:hover{
            background-color: #f0f0f0;
            border:1px inset #aaaaaa;
            outline: none;
        }
        .radiotable{
            width:100%;
            align-items: center;
            text-align: center;
            vertical-align: middle;
            table-layout: fixed;
        }
        .oppositeradio{
            position: relative;
            text-align: left;
            align-items: left;
            width:42%;
            padding-right: 4%;
        }
        .oppositeradio input{
            height: 100%;
        }
        .smalltext-table{
            font-size: 14px;
        }
        .radiocolumn{
            width:6%;
        }
        .radiocolumnlabel{
            width:12%;
            text-align: left;
            align:left;
        }
        .search-panel-button{
            width:92%;
            height:60%;
        }
        .activate-help-button{
            text-align:right;
            width: 20%;
        }
        .search-help-qmark{
            opacity: 0;
        }
        .search-input-panel:hover .search-help-qmark{
            opacity:1;
            transition: opacity 0.15s;
        }
        .search-action-buttons{
            position: fixed;
            top:89%; /* 89vh */
            height:8%; /* 8vh */
            width:21.8%; /* 21.8vw */
        }
        #dropdown-divider{
            height:5px;
            width:100%;
            display: block;
            border-top: 1px solid #3a4620;
            border-bottom: 1px solid #3a4620;
            opacity: 0.3;
            padding: 0px;
            margin: 5px 0px;
        }
        .remove-button{
            background-image: url("resource/x.png");
            height:100%;
            width: 8%;
            right: 5px;
            top:0px;
            position: absolute;
            display: inline-block;
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }
        .remove-button:hover{
            background-image: url("resource/x_over.png");
        }
        .result-topbar{
            width: 45%; /* 45vw */
            height: 5%; /* 5vh */
            font-size: 18px;
            border-bottom: 1px solid #aaaaaa;
            box-shadow: 0px 2px 5px #cccccc;
            overflow: hidden;
            z-index: 999;
            position: fixed;
            background-color: #e4e4e4;
            overflow: visible;
            box-sizing: border-box;
        }
        .result-line-container{
            position: fixed;
            box-sizing: border-box;
            top:5%; /* 5vh */
            width:45%; /* 45vw */
            left:24%; /* 24vw */
            height:92%; /* 92vw */
            overflow-y: overlay;
            overflow-x: hidden;
        }
        .sorting-tab{
            display: none;
            height:100%;
            box-sizing: border-box;
            overflow: auto;
            position: relative;
            overflow: hidden;
            margin: 0px;
            padding: 0px;
            border-right: 1px solid #888888;
        }
        .sorting-tab-label-wrapper, .result-cell-wrapper{
            height: 100%;
            padding: 5px;
            width: 100%;
            table-layout: fixed;
            z-index: 999;
        }
        .sorting-tab-label, .result-cell-text{
            height:100%;
            vertical-align:middle;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }
        .sortable{
            padding-right: 20px;
        }
        .result-cell-wrapper, .result-cell-text{
            width:100%;
            padding: 0px;
            margin: 0px;
            box-sizing: border-box;
        }
        .sorting-tab-arrow{
            height:100%;
            opacity: 0.8;
            width:18px;
            position:absolute;
            top:0px;
            right:5px;
            display: inline-block;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            cursor: pointer;
        }
        .sorting-tab-arrow:before{
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        .sorting-tab-arrow img{
            width:100%;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
        }
        .resize-region{
            opacity: 0.5;
            height:100%;
            width:6px;
            position: absolute;
            top:0px;
            right:0px;
            cursor: e-resize;
            overflow: hidden;
        }
        .result-line{
            width:100%;
            height: 4.348%; /* 4vh */
            font-size: 0;
            border-bottom:1px solid #aaaaaa;
            border-top:0px;
            cursor:pointer;
            box-sizing: border-box;
        }
        .result-line:hover{
            opacity:0.85;
        }
        .result-line div{
            box-sizing: border-box;
            font-size: 18px;
            border:0px;
            border-right: 1px solid #aaaaaa;
            height:100%;
            padding-left: 2px;
            display: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .result-grey-background{
            background-color: #f4f4f4;
        }
        .sorting-tab, .result-line div{
            /* when new columns are shown, this will be the default width */
            width:15%;
        }
        .rclick-context{
            position: fixed;
            display: none;
            z-index: 9999;
            background-color: white;
            border: 1px solid #aaaaaa;
            width:15%; /* 15vw */
        }
        .checkbox-list{
            list-style-type: none;
        }
        .checkbox-list li{
            height:2.75%; /* 2.75vh */
            display: block;
            position: relative;
        }
        .checkbox-list li:hover{
            background-color: #f5f5f5;
        }
        .checkbox-list li:after{
            width:85%;
            height:1px;
            position: absolute;
            display: inline-block;
            z-index: 999;
            content:"";
            bottom: 0px;
            left:2%;
            background-color: #eeeeee;
        }
        .checkbox-list li input{
            position:relative;
            display: inline-block;
            text-align: right;
            vertical-align: middle;
            transform: scale(1.3);
            width:15%;
            opacity: 0.9;
        }
        .checkbox-list li label{
            width:85%;
            position:relative;
            display:inline-block;
            vertical-align: middle;
            padding-left: 6px;
        }
        .checkbox-list li label, .checkbox-list li input{
            cursor: pointer;
            line-height: 140%; /* 2.75vh */
        }
        .show-checkbox{
            display: block;
        }
        .show-column{
            display: inline-block !important;
        }
        .image-box-wrapper{
            width:96.774%; /* 30vw */
            height:39.175%; /* 38vh */
            position: absolute;
            top:3.093%; /* 3vh */
            left: 1.613%; /* 0.5vw */
            display: block;
            margin-bottom: 2.0619%; /* 2vh */
        }
        .image-box{
            width:90%; /* 27vw */
            display: inline-block;
            border: 1px solid #888888;
            height: 100%;
            vertical-align: top;
            white-space: nowrap;
            background-color: white;
            overflow: hidden;
            position: relative;
            padding: 0px;
        }
        .image-view{
            padding: 0px;
            width: 100%;
            height:100%;
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }
        .image-count{
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            color: black;
            right: 0px;
            bottom: 0px;
            padding-top: 2px;
            padding-right: 4px;
            padding-bottom: 0;
            padding-left: 4px;
            border-bottom: 0px solid #888888;
            border-right: 0px solid #888888;
            border-radius: 10px 0px 0px 0px;
            background-clip: padding-box;
        }
        .image-box-panel{
            width: 5%; /* 1.5vw */
            height:100%;
            display: inline-block;
            vertical-align: top;
            white-space: nowrap;
        }
        .image-box-panel img{
            display: inline-block;
            vertical-align: middle;
            width:65%;
            height:8%;
            margin: 0 20%;
        }
        .align-helper{
            display: inline-block;
            height: 100%;
            vertical-align: middle;
        }
        .item-info-container{
            position: absolute;
            display: block;
            width: 96.774%; /* 30vw */
            height: 50.722%; /* 49.2vh */
            padding: 0px 4.839%; /* 0px 1.5vw */
            left: 1.6129%; /* 0.5vw */
            top: 44.33%; /* 43vh */
            overflow-y: overlay;
            overflow-x: hidden;
            font-size: 20px;
            font-family: serif;
        }
        .action-buttons{
            position:absolute;
            display: block;
            width:96.774%; /* 30vw */
            height: 7.01%; /* 6.8vh */
            left: 1.6129%; /* 0.5vw */
            bottom: 1.0309%; /* 1vh */
            padding: 1.8145% 6.452%; /* 1vh 2vw */
        }
        .horizontal-divider{
            margin: 3.049% 13%; /* 1.5vh 13% */
            width: 74%;
            height: 1px;
            border: 0px;
            background-color: #999999;
        }
        .item-panel-button{
            width: 26.923%; /* 7vw */
            height:100%;
            margin: 0px 1.154%; /* 0.3vw */
        }
        .delete-button{
            margin-left: 46.538%; /* 12.1vw */
        }
        .item-info-heading{
            width: 100%; /* 27vw */
            text-align: center;
        }
        .item-info-big{
            font-size: 26px;
        }
        .item-info-medium{
            font-size: 22px;
        }
        .pspace{
            height: 0.5em;
        }
        .info-label{
            color: #555555;
            font-style: italic;
            text-decoration: none;
            border: 0px;
        }
        .item-edit-container{
            box-sizing: border-box;
            height: 92.784%; /* 90vh */
            overflow-x: overlay;
            width: 100%;
            padding-top: 3px;
        }
        .edit-line{
            display: block;
            /*margin-bottom: 1.667%; /* 1.5vh */
            width: 100%;
        }
        .annoying-hacky-edit-spacer{
            height: 1.667%;
            width: 100%;
        }
        .edit-floater{
            float: left;
            padding-right: 2.581%; /* 0.8vw */
            margin-top: 2px;
        }
        .edit-input{
            background-color: white;
            height:100%;
            border: 1px solid #555555;
            border-radius:2px;
            padding: 2px;
            overflow: hidden;
        }
        .edit-small-input{
            min-height:18px; /* 2.8vh */
            width:1.75em; /* 2.5vw */
            text-align: right;
        }
        .edit-wide-input{
            min-height:18px; /* 2.8vh */
            white-space: normal;
        }
        .edit-large-input{
            min-height:68px; /* 8.4vh */
            white-space: normal;
        }
        .edit-medium-input{
            min-height:18px; /* 2.8vh */
            width:3.5em; /* 5vw */
            text-align: right;
        }
        .invisible-edit-container{
            overflow-x: visible;
            overflow-y: hidden;
        }
        .invisible-edit-container div{
            display: inline-block;
        }
        .edit-invisible{
            visibility: hidden;
        }
        .add-image-plus{
            display: table-cell;
            opacity: 0.85;
            height: 20px;
            width: 20px;
            margin-left: 4px;
            cursor: pointer;
            z-index: 99999999999;
        }
        .add-image-plus:hover{
            opacity: 1;
        }
        #m-edit-images-visible, #c-edit-images-visible{
            white-space: nowrap;
            width: 100%;
            padding-top: 3px;
            border-bottom: 1px solid #aaaaaa
        }
        .image-path-container{
            height: 32px;
            padding: 2px;
            display: block;
            position: relative;
            border: 1px solid #aaaaaa;
            border-bottom: 0px;
        }
        .image-path{
            display: inline;
            position: relative;
            margin-left: 24px;
        }
        .image-path-remover{
            position: absolute;
            padding-top: 4px;
            padding-bottom: 4px;
            height: 28px;
            width: 20px;
            display: inline;
            cursor: pointer;
        }
        .box-backdrop{
            z-index: 99999;
            height: 100%;
            width: 100%;
            background-color: rgba(0,0,0,0.3);
            position: absolute;
            top: 0px;
            left: 0px;
            white-space: nowrap;
            display: none;
        }
        .box-backdrop::before{
            content: '';
            display: inline-block;
            height: 35%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        .input-box-button::before{
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        .input-popup{
            display: block;
            vertical-align: middle;
            margin: 0 auto;
            width: 20%;
            height: 20%;
            background-color: white;
            padding: 1.5%;
            position: relative;
        }
        #prompt-box-input{
            line-height: 24px;
            font-size: 24px;
            min-height: 10%;
            padding: 3px;
            border: 1px solid #aaaaaa;
            text-align: center;
            width: 100%;
            margin-bottom: 4%;
            display: block;
        }
        .input-box-button{
            display: inline-block;
            width: 35%;
            height: 20%;
            text-align: center;
            margin: 0 7.5%;
            border: 1px solid #aaaaaa;
            white-space: nowrap;
            cursor: pointer;
            border-radius: 5px;
        }
        .input-box-button div{
            display: inline-block;
            vertical-align: middle;
        }
        .input-box-text{
            white-space: pre-wrap;
            font-size: 18px;
            display: block;
            width: 100%;
            margin-bottom: 4%;
        }
        #confirm-box-text{
            height: 75%;
        }
        #prompt-box-text{
            height: 45%;
        }
        #add-file-errors-backdrop,
        #add-file-good-backdrop{
            z-index: 99999;
            height: 100%;
            width: 100%;
            background-color: rgba(0,0,0,0.3);
            position: absolute;
            top: 0px;
            left: 0px;
            white-space: nowrap;
            display: none;
        }
        
        #add-file-errors-backdrop::before,
        #add-file-good-backdrop::before{
            content: '';
            display: inline-block;
            height: 15%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        
        #add-file-errors-panel,
        #add-file-good-panel{
            width: 70%;
            height: 70%;
            padding: 1%;
            font-size: 22px;
            background-color: white;
            display: block;
            vertical-align: middle;
            margin: 0 auto;
            position: relative;
        }
        
        .add-file-good-header{
            height: 16%;
        }
        .add-file-error-header{
            height: 6%;
        }
        
        #add-file-error-main{
            height: 88%;
            overflow-x: overlay;
            overflow-y: overlay;
        }
        #add-file-error-main div{
            display: block;
            width: 100%;
        }
        #add-file-good-main{
            height: 78%;
            overflow: hidden;
        }
        
        .add-file-ok-button{
            height: 6%;
            width: 10%;
            display: inline-block;
            text-align: center;
            margin: 0 7.5%;
            margin-left: 90%;
            border: 1px solid #aaaaaa;
            white-space: nowrap;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .add-file-ok-button div{
            display: inline-block;
            vertical-align: middle;
        }
        .add-file-ok-button::before{
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em; /* Adjusts for spacing */
        }
        
        #file-add-radiotable{
            margin-top: 3em;
            width: 100%;
        }
        #file-add-radiotable tr td{
            padding-bottom: 2em;
        }
    </style>
</head>
<body>
    <div id="prompt-box-backdrop" class="box-backdrop" >
        <div id="prompt-box" class="input-popup" >
            <div id="prompt-box-text" class="input-box-text"></div>
            <div id="prompt-box-input"></div>
            <div id="prompt-box-go" class="green-button input-box-button">
                <div>OK</div>
            </div>
            <div id="prompt-box-cancel"  class="red-button input-box-button">
                <div>Cancel</div>
            </div>
        </div>
    </div>

    <div id="confirm-box-backdrop" class="box-backdrop" >
        <div id="confirm-box" class="input-popup" >
            <div id="confirm-box-text" class="input-box-text"></div>
            <div id="confirm-box-go" class="green-button input-box-button">
                <div>Yes</div>
            </div>
            <div id="confirm-box-cancel" class="red-button input-box-button">
                <div>No</div>
            </div>
        </div>
    </div>

    <div id="add-file-errors-backdrop">
        <div id="add-file-errors-panel">
            <div class="add-file-error-header">
                The parser found&nbsp;<span id="add-file-error-number"></span>&nbsp;errors in&nbsp;<span id="add-file-error-name"></span>:
            </div>
            <div id="add-file-error-main">

            </div>
            <div class="add-file-ok-button green-button" onclick="ui.close_addfile_popups()">
                <div>OK</div>
            </div>
        </div>
    </div>

    <div id="add-file-good-backdrop">
        <div id="add-file-good-panel">
            <div class="add-file-good-header">
                The parser found no errors in&nbsp;<span id="add-file-good-name"></span>.<br /><br />
                Please choose how you want the program to deal with duplicate items:
            </div>

            <div id="add-file-good-main">
                <form id="add-file-form">
                    <table id="file-add-radiotable">
                        <tr>
                            <td style="text-align:center">
                                <input type="radio" name="fadd-radio" value="3" checked />
                            </td>
                            <td>
                                Add anyway
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center">
                                <input type="radio" name="fadd-radio" value="2" />
                            </td>
                            <td>
                                Overwrite
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center">
                                <input type="radio" name="fadd-radio" value="1" />
                            </td>
                            <td>
                                Skip
                            </td>
                        </tr>
                    </table><br />
                </form>
            </div>
            <div class="add-file-ok-button green-button" onclick="ui.add_from_file(1)">
                <div>Add items</div>
            </div>
        </div>
    </div>

    <div id="id-help-panel" class="help-panel">
        <h1>Help</h1>
        <h2>
            Tables
        </h2>
        Tables are split into two types - Collection tables and the Mineral table. There is only one Mineral table, and it cannot be destroyed.<br /><br />
        It stores information about mineral types, acting as an in-program mini encyclopedia. Collection tables store information about a specific collection
        of minerals, you can have as many of these as you want.<br /><br />
        Collection tables can be created, deleted and swapped between using the drop down menu in the top left corner.
        <h2>
            Searching
        </h2>
        The search panel contains many ways to filter results. The blank box at the top will search in any column, and the boxes below will search in a specific
        database column, for example only name.<br /><br />
        Clicking search when all search boxes are blank will show every result in the table.<br /><br />
        Some numeric search boxes, for example cost, allow you to filter results based on values higher, lower or equal to the value in the search box. This also works
        with dates, individual date fields can be left blank, the program will consider filled fields. This means that if you only fill in the day as the 20th and select
        'less than' comparison the program will find all entries bought before the 20th day of any month of any year.<br /><br />
        The 'And' and 'Or' radio button specify whether the program should find entries that match every condition ('And') or any of the conditions ('Or').
        <h2>
            The result list
        </h2>
        Entries matching the search conditions will be shown in the middle panel. Clicking on a result will display that entry in full in the rightmost panel,
        where they can then be edited or deleted.<br /><br />
        Results can be sorted by some column values - for example, you can sort collection results by purchase number. Sortable columns are indicated by arrows next to their
        name on the top bar, clicking on these arrows changes the sorting.<br /><br />
        There are more columns available than those shown by default - right click on the top panel to disable and enable columns at will. Any column can be resized by dragging
        the right-hand edge of the column title.
        <h2>
            Bulk adding from CSV
        </h2>
        In the bottom right is a button labelled 'Add from CSV'. This enables you to add entries to the current table en masse using a specially formatted  CSV exported
        from Excel. A sample Excel document is provided in this program's install directory - usually C:/Program Files (x86)/GeodeDB/<br /><br />
        Once a file is selected, if there are any formatting or syntactical errors the program will tell you to fix them. Once there are no errors, you will be prompted to
        choose how to deal with duplicate items.<br /><br />
        For collection tables, a duplicate item is defined as one that has the same purchase number and order in purchase as an existing item, and for the Minerals table it is
        defined as one with the same name as an existing item. Duplicates can either be ignored, written over the existing item or added anyway.
        <h2>
            The program directory
        </h2>
        The database and configuration for the program are stored in 3 folders: Config, Database and Images. If you chose a portable installation, these are in the program's install
        directory, which by default is 'My Documents/GeodeDB'. If you did not choose a static installation, they are located in 'C:/Users/[your name]/AppData/Roaming/GeodeDB'.<br /><br />
        The HTML file that defines the appearance and function of the GUI is [install location]/ui/ui.html. This file is compiled from ui/ui_src.html, the CSS files in ui/style and the JavaScript
        files in ui/scripts using 'Generate ui.html from component files.exe'. This allows you to customise the GUI freely, but make sure you back up all of the source files first.
    </div>

    <div id="rclick-context-mineral" class="rclick-context">
        <form>
            <ul class="checkbox-list">
                <li>
                    <label for="mcheck-name">Name</label>
                    <input id="mcheck-name" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-varieties">Varieties</label>
                    <input id="mcheck-varieties" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-description">Description</label>
                    <input id="mcheck-description" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-colours">Colours</label>
                    <input id="mcheck-colours" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-structure">Crystal structure</label>
                    <input id="mcheck-structure" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-composition">Chemical formula</label>
                    <input id="mcheck-composition" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-images">Image count</label>
                    <input id="mcheck-images" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-category">Category</label>
                    <input id="mcheck-category" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
                <li>
                    <label for="mcheck-pagenumber">Page number</label>
                    <input id="mcheck-pagenumber" type="checkbox" onclick="ui.toggle_mineral_column(this.id)" />
                </li>
            </ul>
        </form>
    </div>

    <div id="rclick-context-collection" class="rclick-context">
        <form>
            <ul class="checkbox-list">
                <li>
                    <label for="ccheck-number">Purchase number</label>
                    <input id="ccheck-number" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-order">Order in purchase</label>
                    <input id="ccheck-order" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-name">Name</label>
                    <input id="ccheck-name" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-type">Mineral type</label>
                    <input id="ccheck-type" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-description">Description</label>
                    <input id="ccheck-description" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-colours">Colours</label>
                    <input id="ccheck-colours" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-date">Date of purchase</label>
                    <input id="ccheck-date" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-purchaseplace">Place of purchase</label>
                    <input id="ccheck-purchaseplace" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-notes">Notes</label>
                    <input id="ccheck-notes" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-cost">Cost (&pound;)</label>
                    <input id="ccheck-cost" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-buyer">Buyer</label>
                    <input id="ccheck-buyer" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-location">Location</label>
                    <input id="ccheck-location" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-images">Image count</label>
                    <input id="ccheck-images" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
                <li>
                    <label for="ccheck-texture">Texture</label>
                    <input id="ccheck-texture" type="checkbox" onclick="ui.toggle_collection_column(this.id)" />
                </li>
            </ul>
        </form>
    </div>

    <!--
    |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    -->

    <div class="main-panel search-panel">

        <div id="search-top-panel-container">
            <div class="dropdown">
                <div class="table-tab" id="collection-tab">
                    <div id="collection-tab-text-wrapper" onclick="ui.activate_collection_table()">
                        <div id="collection-tab-text">

                        </div>
                    </div>
                    <div id="dropdown-arrow-container" onclick="ui.dropdown()">
                        <img id="dropdown-arrow-id" class="dropdown-arrow" src="resource/arrow_down_centered.png" />
                    </div>
                </div><!--
                --><div class="dropdown-content" id="dropdown-menu">
                    <div id="dropdown-divider">

                    </div>
                    <div class="dropdown-content" onclick="ui.get_table_name()" style="padding-bottom:0.1em">
                        Add new table
                    </div>
                </div>
            </div>
            <div class="dropdown" id ="mineral-tab-wrapper">
                <div class="table-tab" id="mineral-tab" onclick="ui.activate_mineral_table()">
                <div>Mineral types</div>
                </div>
            </div>
        </div>

        <div class="search-input-panel" id="collection-search-input-panel">
            <div class="search-top-heading search-heading">
                Search
            </div><!--
            --><div class="search-top-heading activate-help-button">
                <span class="tooltip help-button" style="text-decoration:underline;border:0px;" onclick="ui.help_popup()">
                    Help
                    <span class="tooltiptext">Show help window</span>
                </span>
            </div>
            <form class="search-form" id="collection-search-form" onsubmit="return false;">
                <input type="text" name="main-search" class="input-box" /><br /><br />
                <table class="radiotable">
                    <tr>
                        <td class="oppositeradio search-heading" style="padding-bottom:5px;">
                            Search&nbsp;in&nbsp;fields:
                        </td>
                        <td class="radiocolumn">
                            <input id="c-radio-and" type="radio" name="c-andor" value="and" onclick="ui.set_mask('c-and')" />
                        </td>
                        <td class="radiocolumnlabel">
                            And
                        </td>
                        <td class="radiocolumn">
                            <input id="c-radio-or" type="radio" name="c-andor" value="or" onclick="ui.set_mask('c-or')" />
                        </td>
                        <td class="radiocolumnlabel">
                            Or
                        </td>
                    </tr>
                </table>

                Name<br />
                <input type="text" name="name-search" class="input-box" placeholder="e.g. jasper" /><br />

                Purchase number<br />
                <table class="radiotable">
                    <tr>
                        <td class="oppositeradio">
                            <input type="number" min="1" name="purchase-num-search" class="input-box" placeholder="e.g. 31" /><br />
                        </td class="radiocolumn">

                        <td class="radiocolumn">
                            <input id="radio-num-less" type="radio" name="numcomp" value="-1" onclick="ui.set_mask('num', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            <
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-num-equal" type="radio" name="numcomp" value="0" onclick="ui.set_mask('num', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            =
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-num-greater" type="radio" name="numcomp" value="1" onclick="ui.set_mask('num', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            >
                        </td>
                    </tr>
                </table>

                Acquisition date<br />
                <table class="radiotable smalltext-table">
                    <tr>
                        <td class="oppositeradio">
                            <table>
                                <tr>
                                    <td style="width:25%">
                                        <input style="text-align:center;" type="number" min="1" max="31" name="date-day-search" class="input-box" placeholder="dd" />
                                    </td>
                                    <td style="width:5%">-</td>
                                    <td style="width:25%">
                                        <input style="text-align:center;" type="number" min="1" max="12" name="date-month-search" class="input-box" placeholder="mm" />
                                    </td>
                                    <td style="width:5%">-</td>
                                    <td style="width:40%">
                                        <input style="text-align:center;" type="number" min="1000" max="9999" name="date-year-search" class="input-box" placeholder="yyyy" />
                                    </td>
                                </tr>
                            </table>
                        </td>

                        <td class="radiocolumn">
                            <input id="radio-date-less" type="radio" name="datecomp" value="-1" onclick="ui.set_mask('date', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            Before
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-date-equal" type="radio" name="datecomp" value="0" onclick="ui.set_mask('date', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            On
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-date-greater" type="radio" name="datecomp" value="1" onclick="ui.set_mask('date', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            After
                        </td>
                    </tr>
                </table>

                Cost<br />
                <table class="radiotable">
                    <tr>
                        <td class="oppositeradio">
                            <span style="position:absolute;margin-top:27%;color:#aaaaaa;margin-left:0.3em;z-index:99">&pound;</span><input type="number" min="0" step="0.01" style="padding-left:1.2em;" placeholder="0.50" name="cost-search" class="input-box" /><br />
                        </td class="radiocolumn">

                        <td class="radiocolumn">
                            <input id="radio-cost-less" type="radio" name="costcomp" value="-1" onclick="ui.set_mask('cost', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            <
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-cost-equal" type="radio" name="costcomp" value="0" onclick="ui.set_mask('cost', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            =
                        </td>
                        <td class="radiocolumn">
                            <input id="radio-cost-greater" type="radio" name="costcomp" value="1" onclick="ui.set_mask('cost', this.value)" />
                        </td>
                        <td class="radiocolumnlabel">
                            >
                        </td>
                    </tr>
                </table>

                Mineral<br />
                <input type="text" name="mineral-search" class="input-box" placeholder="e.g. calcite" /><br />

                Colours<br />
                <input type="text" name="colour-search" class="input-box" placeholder="e.g. red, green" /><br />

                Description<br />
                <input type="text" name="description-search" class="input-box" placeholder="e.g. stripes" /><br />

                Notes<br />
                <input type="text" name="notes-search" class="input-box" placeholder="e.g. birthday"/><br />

                Purchase location<br />
                <input type="text" name="purchase-search" class="input-box" placeholder="e.g. exeter" /><br />

                Display location<br />
                <input type="text" name="location-search" class="input-box" placeholder="e.g. bowl" /><br />

                Buyer<br />
                <input type="text" name="buyer-search" class="input-box" placeholder="e.g. dad" /><br />

                <table class="radiotable search-action-buttons">
                    <tr>
                        <td style="width:30%;">
                            <button class="search-panel-button green-button" type="button" onclick="ui.clear_collection_form()">Clear</button>
                        </td>
                        <td style="width:40%">
                            <button class="search-panel-button darkgreen-button" type="button" onclick="ui.search_collection_db()">Search</button>
                        </td>
                        <td style="width:30%">
                            <button class="search-panel-button green-button" type="button" onclick="ui.new_item('collection')">New</button>
                        </td>
                    </tr>
                </table>

            </form>
        </div>

        <div class="search-input-panel" id="mineral-search-input-panel">
            <div class="search-top-heading search-heading">
                Search
            </div><!--
            --><div class="search-top-heading activate-help-button">
                <span class="tooltip help-button" style="text-decoration:underline;border:0px" onclick="ui.help_popup()">
                    Help
                    <span class="tooltiptext">Show help window</span>
                </span>
            </div>
            <form class="search-form" id="mineral-search-form" onsubmit="return false;">
                <input type="text" name="main-search" class="input-box" /><br /><br />
                <table class="radiotable">
                    <tr>
                        <td class="oppositeradio search-heading" style="padding-bottom:5px;">
                            Search&nbsp;in&nbsp;fields:
                        </td>
                        <td class="radiocolumn">
                            <input id="m-radio-and" type="radio" name="m-andor" value="and" onclick="ui.set_mask('m-and')" />
                        </td>
                        <td class="radiocolumnlabel">
                            And
                        </td>
                        <td class="radiocolumn">
                            <input id="m-radio-or" type="radio" name="m-andor" value="or" onclick="ui.set_mask('m-or')" />
                        </td>
                        <td class="radiocolumnlabel">
                            Or
                        </td>
                    </tr>
                </table><br />

                Name<br />
                <input type="text" name="name-search" class="input-box" placeholder="e.g. aragonite" /><br />

                Varieties<br />
                <input type="text" name="variety-search" class="input-box" placeholder="e.g. travertine" /><br />

                Colours<br />
                <input type="text" name="colours-search" class="input-box" placeholder="e.g. blue"/><br />

                Description<br />
                <input type="text" name="description-search" class="input-box" placeholder="e.g. stripes" /><br />

                Crystal structure<br />
                <input type="text" name="structure-search" class="input-box" placeholder="e.g. orthorhombic" /><br />

                Composition<br />
                <input type="text" name="composition-search" class="input-box" placeholder="e.g. Ca" /><br />

                Nickel-Strunz Category<br />
                <input type="text" name="category-search" class="input-box" placeholder="e.g. Carbonates" /><br />

                <table class="radiotable search-action-buttons">
                    <tr>
                        <td style="width:30%">
                            <button class="search-panel-button green-button" type="button" onclick="ui.clear_mineral_form()">Clear</button>
                        </td>
                        <td style="width:40%">
                            <button class="search-panel-button darkgreen-button" type="button" onclick="ui.search_mineral_db()">Search</button>
                        </td>
                        <td style="width:30%">
                            <button class="search-panel-button green-button" type="button" onclick="ui.new_item('mineral')">New</button>
                        </td>
                    </tr>
                </table>

            </form>
        </div>

    </div>

    <!--
    |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    -->

    <div class="main-panel results-panel" id="collection-results-panel">
        <div class="result-topbar" id="collection-results-topbar"><!--

            --><div class="sorting-tab ccol-number sortable" id="clab-number">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Purchase number
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_collection_sorting_mask(1)">
                    <img id="c-number-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-order" id="clab-order">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Order in purchase
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-name sortable" id="clab-name">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Name
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_collection_sorting_mask(0)">
                    <img id="c-name-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-type sortable" id="clab-type">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Mineral type
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_collection_sorting_mask(4)">
                    <img id="c-type-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-description" id="clab-description">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Description
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-colours" id="clab-colours">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Colours
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-date sortable" id="clab-date">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Date of purchase
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_collection_sorting_mask(2)">
                    <img id="c-date-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-purchaseplace" id="clab-purchaseplace">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Place of purchase
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-notes" id="clab-notes">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Notes
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-cost sortable" id="clab-cost">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Cost
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_collection_sorting_mask(3)">
                    <img id="c-cost-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-buyer" id="clab-buyer">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Buyer
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-location" id="clab-location">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Location
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-images" id="clab-images">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Image count
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab ccol-texture" id="clab-texture">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Texture
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

        --></div>

        <div class="result-line-container" id="collection-result-line-container">

        </div>

    </div>

    <div class="main-panel results-panel" id="mineral-results-panel">
        <div class="result-topbar" id="mineral-results-topbar">


            <div class="sorting-tab mcol-name sortable" id="mlab-name">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Name
                        </td>
                    </tr>
                </table>
                <div class="sorting-tab-arrow" onclick="ui.change_mineral_sorting_mask()">
                    <img id="m-name-sorting-arrow" src="resource/arrow_dual.png" />
                </div>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-varieties" id="mlab-varieties">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Varieties
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-description" id="mlab-description">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Description
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-colours" id="mlab-colours">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Colours
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-structure" id="mlab-structure">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Crystal structure
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-composition" id="mlab-composition">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Chemical formula
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-images" id="mlab-images">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Image count
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-category" id="mlab-category">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Category (Nickel-Strunz)
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div><!--

            ---><div class="sorting-tab mcol-pagenumber" id="mlab-pagenumber">
                <table class="sorting-tab-label-wrapper">
                    <tr>
                        <td class="sorting-tab-label">
                            Page number
                        </td>
                    </tr>
                </table>
                <div class="resize-region"></div>
            </div>


        </div>

        <div class="result-line-container" id="mineral-result-line-container">

        </div>
    </div>

    <!--
    |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    -->

    <div class="main-panel item-panel" id="view-collection-item-panel">
        <div class="image-box-wrapper">
            <div class="image-box-left-panel image-box-panel">
                <span class="align-helper"></span><!---
            ---><img id="collection-image-arrow-left" src="resource/arrow_left_null.png" onclick="ui.decrement_image('collection')" />
            </div><!---
            ---><div class="image-box">
                <div class="image-view" id="collection-image">
                </div>
                <div class="image-count" id="collection-image-count"></div>
            </div><!---
            ---><div class="image-box-right-panel image-box-panel">
                <span class="align-helper"></span><!---
            ---><img id="collection-image-arrow-right" src="resource/arrow_right_null.png" onclick="ui.advance_image('collection')" />
            </div>
        </div>
        <div class="item-info-container">
            <div class="item-info-heading">
                <span class="item-info-big" id="collection-item-name"></span><br /><div class="pspace"></div>
                <span class="item-info-medium" id="collection-item-type"></span>
            </div>
            <div class="horizontal-divider"></div>
            <span id="collection-item-description"></span><br /><div class="pspace"></div>
            <span id="collection-item-notes"></span>
            <div class="horizontal-divider"></div>
            <span id="collection-item-purchase"></span>
            <div class="horizontal-divider"></div>
            <span class="info-label" id="view-coll-colours-label">Colours: </span><span id="collection-item-colours"></span><br /><div class="pspace"></div>
            <span id="collection-item-location"></span><br /><div class="pspace"></div>
            <span id="collection-item-texture"></span>
        </div>
        <div class="action-buttons">
            <button class="delete-button item-panel-button red-button" onclick="ui.confirm_delete_item('collection')">Delete</button>
            <button class="item-panel-button green-button" onclick="ui.edit_collection_item()">Edit</button>
        </div>
    </div>

    <div class="main-panel item-panel" id="view-mineral-item-panel">
        <div class="image-box-wrapper">
            <div class="image-box-left-panel image-box-panel">
                <span class="align-helper"></span><!---
            ---><img id="mineral-image-arrow-left" src="resource/arrow_left_null.png" onclick="ui.decrement_image('mineral')" />
            </div><!---
            ---><div class="image-box">
                <div class="image-view" id="mineral-image">
                </div>
                <div class="image-count" id="mineral-image-count"></div>
            </div><!---
            ---><div class="image-box-right-panel image-box-panel">
                <span class="align-helper"></span><!---
            ---><img id="mineral-image-arrow-right" src="resource/arrow_right_null.png" onclick="ui.advance_image('mineral')" />
            </div>
        </div>
        <div class="item-info-container">
            <div class="item-info-heading">
                <span class="item-info-big" id="mineral-item-name"></span><br /><div class="pspace"></div>
                <span class="item-info-medium" id="mineral-item-strucformula"></span>
            </div>
            <div class="horizontal-divider"></div>
            <span id="mineral-item-description"></span>
            <div class="horizontal-divider"></div>
            <span class="info-label" id="view-min-varieties-label">Varieties: </span><span id="mineral-item-varieties"></span>
            <div class="horizontal-divider"></div>
            <span class="info-label" id="view-min-category-label">Nickel Strunz category: </span><span id="mineral-item-nickelstrunz"></span><br /><div class="pspace"></div>
            <span class="info-label tooltip" id="view-min-pagenum-label">Page number:&nbsp;
                <span id="item-view-tooltip" class="tooltiptext">
                    Page number of this mineral in <i>The</i> <i>Complete</i> <i>Encyclopedia</i> <i>of</i> <i>Minerals</i>, Petr Korbel and Milan Nov&aacute;k (1999, Rebo)</span>
            </span><span id="mineral-item-pagenum"></span>
            <div class="horizontal-divider"></div>
            <span class="info-label" id="view-min-colours-label">Colours: </span><span id="mineral-item-colours"></span>
        </div>
        <div class="action-buttons">
            <button class="delete-button item-panel-button red-button" onclick="ui.confirm_delete_item('mineral')">Delete</button>
            <button class="item-panel-button green-button" onclick="ui.edit_mineral_item()">Edit</button>
        </div>
    </div>

    <div class="main-panel item-panel" id="edit-collection-item-panel">
        <div class="item-edit-container">
            <div class="edit-line">
                <div class="edit-floater">
                    Purchase number:
                </div>
                <div id="c-edit-number" class="edit-input edit-medium-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Order in purchase:
                </div>
                <div id="c-edit-order" class="edit-input edit-small-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Name:
                </div>
                <div id="c-edit-name" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Mineral type:
                </div>
                <div id="c-edit-type" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Description:
                </div>
                <div class="edit-input edit-invisible"></div>
                <div id="c-edit-description" class="edit-input edit-large-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Notes:
                </div>
                <div class="edit-input edit-invisible"></div>
                <div id="c-edit-notes" class="edit-input edit-large-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Purchase date (dd-mm-yyyy):
                </div>
                <div class="invisible-edit-container">
                    <div id="c-edit-date-day" class="edit-input edit-small-input"></div>
                    <div id="c-edit-date-month" class="edit-input edit-small-input"></div>
                    <div id="c-edit-date-year" class="edit-input edit-medium-input"></div>
                </div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Purchase location:
                </div>
                <div id="c-edit-purchaseplace" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Cost (pence):
                </div>
                <div id="c-edit-cost" class="edit-input edit-medium-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Buyer:
                </div>
                <div id="c-edit-buyer" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Colours:
                </div>
                <div id="c-edit-colours" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Place of repose:
                </div>
                <div id="c-edit-location" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Texture:
                </div>
                <div class="invisible-edit-container">
                    <table style="width:100%;align-items:center;">
                        <tr>
                            <td style="text-align:center; vertical-align:middle;">
                                Tumbled <input type="radio" name="c-edit-texture" value="1"/>
                            </td>
                            <td>
                                Rough <input type="radio" name="c-edit-texture" value="0" />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    <table><tr>
                        <td>
                            Images:
                        </td>
                        <td style="vertical-align: middle;">
                            <img src="resource/plus.png" class="add-image-plus" onclick="ui.choose_images('c')"></img>
                        </td>
                    </tr></table>
                </div>
                <div class="edit-input edit-invisible"></div>
                <div id="c-edit-images" style="display:none;"></div>
                <div id="c-edit-images-visible"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="delete-button item-panel-button red-button" onclick="ui.cancel_item_edit()">Cancel</button>
            <button class="item-panel-button green-button" onclick="ui.save_collection_item()">Save</button>
        </div>
    </div>

    <div class="main-panel item-panel" id="edit-mineral-item-panel">
        <div class="item-edit-container">
            <div class="edit-line">
                <div class="edit-floater">
                    Name:
                </div>
                <div id="m-edit-name" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Varieties:
                </div>
                <div id="m-edit-varieties" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Crystal structure:
                </div>
                <div id="m-edit-structure" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Chemical composition:
                </div>
                <div id="m-edit-composition" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Description:
                </div>
                <div class="edit-input edit-invisible"></div>
                <div id="m-edit-description" class="edit-input edit-large-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Nickel-Strunz category:
                </div>
                <div id="m-edit-category" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Reference page number:
                </div>
                <div id="m-edit-pagenumber" class="edit-input edit-medium-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    Colours:
                </div>
                <div id="m-edit-colours" class="edit-input edit-wide-input"></div>
            </div>
            <div class="annoying-hacky-edit-spacer"></div>
            <div class="edit-line">
                <div class="edit-floater">
                    <table><tr>
                        <td>
                            Images:
                        </td>
                        <td style="vertical-align: middle;">
                            <img src="resource/plus.png" class="add-image-plus" onclick="ui.choose_images('m')"></img>
                        </td>
                    </tr></table>
                </div>
                <div class="edit-input edit-invisible"></div>
                <div id="m-edit-images" style="display:none;"></div>
                <div id="m-edit-images-visible"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="delete-button item-panel-button red-button" onclick="ui.cancel_item_edit()">Cancel</button>
            <button class="item-panel-button green-button" onclick="ui.save_mineral_item()">Save</button>
        </div>
    </div>

    <div id="global-status-bar">
        <div id="status-wrapper"></div>
        <div id="mass-addition-button" onclick="ui.add_from_file()" >
            Add from CSV
        </div>
    </div>
    <script>
        function redbox(box)
        {
            document.getElementById(box).style.boxShadow = "inset 0px 0px 4px red";
        }
        
        function remove_collection_image(index)
        {
            var target = document.getElementById("c-edit-images-visible").children[index];
            target.parentElement.removeChild(target);
            var path = document.getElementById("c-edit-images").children[index];
            var removed = path.innerText;
            path.parentElement.removeChild(path);
            ui.remove_collection_image(removed);
        }
        
        function remove_mineral_image(index)
        {
            var target = document.getElementById("m-edit-images-visible").children[index];
            target.parentElement.removeChild(target);
            var path = document.getElementById("m-edit-images").children[index];
            var removed = path.innerText;
            path.parentElement.removeChild(path);
            ui.remove_mineral_image(removed);
        }
        
        function add_mineral_image_path(path, abort)
        {
            var container = document.getElementById("m-edit-images-visible");
        
            var newline = document.createElement("div");
            var newpath = document.createElement("div");
            var newcross = document.createElement("img");
            var newtext = document.createTextNode(namepart(path));
        
            newline.classList.add("image-path-container");
            newpath.classList.add("image-path");
            newcross.classList.add("image-path-remover");
            newcross.src = "resource/x_over.png";
        
            var hiddenpaths = document.getElementById("m-edit-images");
            var hidepath = document.createElement("div");
            var hidetext = document.createTextNode('');
            hidepath.appendChild(hidetext);
            hidepath.innerText = path;
            hiddenpaths.appendChild(hidepath);
        
            newcross.onclick = function()
                               {
                                   var i = 0;
                                   var node = this.parentElement;
                                   while(node.previousSibling)
                                   {
                                       node = node.previousSibling;
                                       i++;
                                   }
                                   ui.remove_mineral_image(i);
                               };
        
            newpath.appendChild(newtext);
            newline.appendChild(newcross);
            newline.appendChild(newpath);
        
            if(abort === true) return;
        
            container.appendChild(newline);
        }
        
        function add_collection_image_path(path, abort)
        {
            var container = document.getElementById("c-edit-images-visible");
        
            var newline = document.createElement("div");
            var newpath = document.createElement("div");
            var newcross = document.createElement("img");
            var newtext = document.createTextNode(namepart(path));
        
            newline.classList.add("image-path-container");
            newpath.classList.add("image-path");
            newcross.classList.add("image-path-remover");
            newcross.src = "resource/x_over.png";
        
            var hiddenpaths = document.getElementById("c-edit-images");
            var hidepath = document.createElement("div");
            var hidetext = document.createTextNode('');
            hidepath.appendChild(hidetext);
            hidepath.innerText = path;
            hiddenpaths.appendChild(hidepath);
        
            newcross.onclick = function()
                               {
                                   var i = 0;
                                   var node = this.parentElement;
                                   while(node.previousSibling)
                                   {
                                       node = node.previousSibling;
                                       i++;
                                   }
                                   ui.remove_collection_image(i);
                               };
        
            newpath.appendChild(newtext);
            newline.appendChild(newcross);
            newline.appendChild(newpath);
        
            if(abort === true) return;
        
            container.appendChild(newline);
        }
        
        function get_mineral_data()
        {
            document.getElementById("m-edit-pagenumber" ).style.boxShadow = "none";
        
            var mentry = new MineralEntry();
            var numbuffer, imgbuffer;
        
            mentry.name        =         document.getElementById("m-edit-name"       ).innerText.replace(/\n/g, '');
            mentry.varieties   = explode(document.getElementById("m-edit-varieties"  ).innerText.replace(/\n/g, ''), ",");
            mentry.structure   =         document.getElementById("m-edit-structure"  ).innerText.replace(/\n/g, '');
            mentry.description =         document.getElementById("m-edit-description").innerText;
            mentry.colours     = explode(document.getElementById("m-edit-colours"    ).innerText.replace(/\n/g, ''), ",");
            mentry.composition =         document.getElementById("m-edit-composition").innerText.replace(/\n/g, '');
            mentry.category    =         document.getElementById("m-edit-category"   ).innerText.replace(/\n/g, '');
            numbuffer          =         document.getElementById("m-edit-pagenumber" ).innerText.replace(/\n/g, '');
            imgbuffer          =         document.getElementById("m-edit-images"     ).children;
        
            mentry.images = [];
            for(var i = 0; i < imgbuffer.length; i++)
            {
                mentry.images.push(imgbuffer[i].innerText.replace(/\n/g, ''));
            }
        
            mentry.description = mentry.description.replace(/<div>/g, '\n');
            mentry.description = mentry.description.replace(/<\/div>/g, '');
        
            if(!is_integer(numbuffer))
            {
                status("Page number should be a positive integer", true);
                redbox("m-edit-pagenumber");
                return false;
            }
            else
            {
                mentry.pagenumber = (parseInt(numbuffer, 10) !== parseInt(numbuffer, 10)) ? -1 : parseInt(numbuffer, 10);
            }
        
            mentry.name        = mentry.name.replace(/&nbsp;/g, " ");
            mentry.structure   = mentry.structure.replace(/&nbsp;/g, " ");
            mentry.description = mentry.description.replace(/&nbsp;/g, " ");
            mentry.composition = mentry.composition.replace(/&nbsp;/g, " ");
            mentry.category    = mentry.category.replace(/&nbsp;/g, " ");
        
            if(mentry.description.substr(-1,1) === "\n")
            {
                mentry.description = mentry.description.substr(0, mentry.description.length - 1);
            }
            if(mentry.description.length > 0)
            {
                if(mentry.description[0] === "\n")
                {
                    mentry.description = mentry.description.substr(1);
                }
            }
        
            if(mentry.pagenumber !== mentry.pagenumber)
            {
                mentry.cost = -1;
            }
        
            return mentry;
        }
        
        function get_collection_data()
        {
            document.getElementById("c-edit-date-day" ).style.boxShadow = "none";
            document.getElementById("c-edit-date-month" ).style.boxShadow = "none";
            document.getElementById("c-edit-date-year" ).style.boxShadow = "none";
            document.getElementById("c-edit-cost" ).style.boxShadow = "none";
            document.getElementById("c-edit-number" ).style.boxShadow = "none";
            document.getElementById("c-edit-order" ).style.boxShadow = "none";
        
            var mentry = new CollectionEntry();
            var numbuffer, costbuffer, imgbuffer, dbufday, dbufmnth, dbufyr;
        
            numbuffer            =         document.getElementById("c-edit-number"       ).innerText.replace(/\n/g, '');
            mentry.order         =         document.getElementById("c-edit-order"        ).innerText.replace(/\n/g, '');
            mentry.name          =         document.getElementById("c-edit-name"         ).innerText.replace(/\n/g, '');
            mentry.type          = explode(document.getElementById("c-edit-type"         ).innerText.replace(/\n/g, ''), ",");
            mentry.description   =         document.getElementById("c-edit-description"  ).innerText;
            mentry.notes         =         document.getElementById("c-edit-notes"        ).innerText;
            mentry.purchaseplace =         document.getElementById("c-edit-purchaseplace").innerText.replace(/\n/g, '');
            costbuffer           =         document.getElementById("c-edit-cost"         ).innerText.replace(/\n/g, '');
            mentry.buyer         =         document.getElementById("c-edit-buyer"        ).innerText.replace(/\n/g, '');
            mentry.colours       = explode(document.getElementById("c-edit-colours"      ).innerText.replace(/\n/g, ''), ",");
            mentry.location      =         document.getElementById("c-edit-location"     ).innerText.replace(/\n/g, '');
            imgbuffer            =         document.getElementById("c-edit-images"       ).children;
        
            mentry.images = [];
            for(var i = 0; i < imgbuffer.length; i++)
            {
                mentry.images.push(imgbuffer[i].innerText.replace(/\n/g, ''));
            }
        
            dbufday  = document.getElementById("c-edit-date-day").innerText;
            dbufmnth = document.getElementById("c-edit-date-month").innerText;
            dbufyr   = document.getElementById("c-edit-date-year").innerText;
        
            var radios = document.getElementsByName("c-edit-texture");
            for(var i = 0; i < radios.length; i++)
            {
                if(radios[i].checked)
                {
                    mentry.texture = parseInt(radios[i].value, 10);
                    break;
                }
            }
        
            mentry.description = mentry.description.replace(/<div>/g, '\n');
            mentry.description = mentry.description.replace(/<\/div>/g, '');
            mentry.notes = mentry.notes.replace(/<div>/g, '\n');
            mentry.notes = mentry.notes.replace(/<\/div>/g, '');
        
            if(mentry.description.substr(-1,1) === "\n")
            {
                mentry.description = mentry.description.substr(0, mentry.description.length - 1);
            }
            if(mentry.description.length > 0)
            {
                if(mentry.description[0] === "\n")
                {
                    mentry.description = mentry.description.substr(1);
                }
            }
            if(mentry.notes.substr(-1,1) === "\n")
            {
                mentry.notes = mentry.notes.substr(0, mentry.notes.length - 1);
            }
            if(mentry.notes.length > 0)
            {
                if(mentry.notes[0] === "\n")
                {
                    mentry.notes = mentry.notes.substr(1);
                }
            }
        
            if(!is_integer(numbuffer))
            {
                status("Purchase number should be a positive integer", true);
                redbox("c-edit-number");
                return false;
            }
            else
            {
                mentry.number = parseInt(numbuffer, 10);
            }
        
            if(!is_integer(costbuffer))
            {
                status("Cost should be a positive integer", true);
                redbox("c-edit-cost");
                return false;
            }
            else
            {
                mentry.cost = parseInt(costbuffer, 10);
            }
        
            if(!is_antinumber(mentry.order))
            {
                status("Order should not contain numbers", true);
                redbox("c-edit-order");
                return false;
            }
        
            mentry.order = mentry.order.replace(/&nbsp;/g, " ");
            mentry.name = mentry.name.replace(/&nbsp;/g, " ");
            mentry.description = mentry.description.replace(/&nbsp;/g, " ");
            mentry.purchaseplace = mentry.purchaseplace.replace(/&nbsp;/g, " ");
            mentry.notes = mentry.notes.replace(/&nbsp;/g, " ");
            mentry.buyer = mentry.buyer.replace(/&nbsp;/g, " ");
            mentry.location = mentry.location.replace(/&nbsp;/g, " ");
        
            if(mentry.cost !== mentry.cost)
            {
                mentry.cost = -1;
            }
            if(mentry.number !== mentry.number)
            {
                mentry.number = -1;
            }
        
            if(dbufday.length === 1){
                dbufday = '0'+dbufday;
            }
            if(dbufmnth.length === 1){
                dbufmnth = '0'+dbufmnth;
            }
            if((dbufday.length === 0) && (dbufmnth.length+dbufyr.length > 0)){
                status("Please fill in a day", true);
                redbox("c-edit-date-day");
                return false;
            }
            if((dbufmnth.length === 0) && (dbufday.length+dbufyr.length > 0)){
                status("Please fill in a month", true);
                redbox("c-edit-date-month");
                return false;
            }
            if((dbufyr.length === 0) && (dbufmnth.length+dbufday.length > 0)){
                status("Please fill in a year", true);
                redbox("c-edit-date-year");
                return false;
            }
            if(!is_integer(dbufday) || (parseInt(dbufday, 10) > 31) || (parseInt(dbufday, 10) === 0))
            {
                status("Invalid day", true);
                redbox("c-edit-date-day");
                return false;
            }
            if(!is_integer(dbufmnth) || (parseInt(dbufmnth, 10) > 12) || (parseInt(dbufmnth, 10) === 0))
            {
                status("Invalid month", true);
                redbox("c-edit-date-month");
                return false;
            }
            if(!is_integer(dbufyr) || ((dbufyr.length !== 4) && (dbufyr.length !== 0)))
            {
                status("Invalid year", true);
                redbox("c-edit-date-year");
                return false;
            }
        
            if(dbufday.length + dbufmnth.length + dbufyr.length === 8)
            {
                mentry.date = dbufday + '-' + dbufmnth + "-" + dbufyr;
            }
        
            status('Data collected');
        
            return mentry;
        }
        
        function fill_mineral_data(mentry)
        {
            var boxes = ["name", "description", "structure", "category", "pagenumber", "colours", "images", "varieties"];
            for(var i = 0; i < boxes.length; i++)
            {
                document.getElementById("m-edit-"+boxes[i]).innerText = '';
            }
        
            var tmp = '';
        
            for(var i = 0; i < boxes.length - 3; i++)
            {
                if(typeof mentry[boxes[i]] !== "number")
                {
                    if(mentry[boxes[i]].indexOf('\n') === -1)
                    {
                        document.getElementById("m-edit-"+boxes[i]).innerText = mentry[boxes[i]];
                    }
                    else
                    {
                        tmp = mentry[boxes[i]];
                        tmp = tmp.replace(/\n/g, "</div><div>") + '</div>'; // replace all newlines with </div><div> pairs, and add final </div>
                        tmp.replace("</div>", ''); // remove first </div>
                        document.getElementById("m-edit-"+boxes[i]).innerHTML = tmp;
                    }
                }
                else if(mentry[boxes[i]] !== -1)
                {
                    document.getElementById("m-edit-"+boxes[i]).innerText = mentry[boxes[i]];
                }
            }
        
            document.getElementById("m-edit-composition").innerText = anti_subscript_numbers(mentry.composition);
        
            document.getElementById("m-edit-varieties").innerText = list_to_string(mentry.varieties);
            document.getElementById("m-edit-colours").innerText = list_to_string(mentry.colours);
        
            var container = document.getElementById("m-edit-images-visible");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
            container = document.getElementById("m-edit-images");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
            for(var i = 0; i < mentry.images.length; i++)
            {
                add_mineral_image_path(mentry.images[i]);
            }
        }
        
        function fill_collection_data(centry)
        {
            // clear any previous data
            var boxes = ["number", "order", "name", "purchaseplace", "cost", "buyer", "location", "description", "notes", "date-day", "date-month", "date-year", "images", "colours", "type"];
            for(var i = 0; i < boxes.length; i++)
            {
                document.getElementById("c-edit-"+boxes[i]).innerText = '';
            }
            var radios = document.getElementsByName("c-edit-texture");
            for(var i = 0; i < radios.length; i++)
            {
                radios[i].checked = false;
            }
        
            // add data from centry
            var tmp = '';
        
            for(var i = 0; i < boxes.length - 6; i++)
            {
                if(typeof centry[boxes[i]] !== "number")
                {
                    if(centry[boxes[i]].indexOf('\n') === -1)
                    {
                        document.getElementById("c-edit-"+boxes[i]).innerText = centry[boxes[i]];
                    }
                    else
                    {
                        tmp = centry[boxes[i]];
                        tmp = tmp.replace(/\n/g, "</div><div>") + '</div>';
                        tmp.replace("</div>", '');
                        document.getElementById("c-edit-"+boxes[i]).innerText = tmp;
                    }
                }
                else if(centry[boxes[i]] !== -1)
                {
                    document.getElementById("c-edit-"+boxes[i]).innerText = centry[boxes[i]];
                }
            }
        
            document.getElementById("c-edit-type").innerText = list_to_string(centry.type);
            document.getElementById("c-edit-colours").innerText = list_to_string(centry.colours);
        
            var container = document.getElementById("c-edit-images-visible");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
            container = document.getElementById("c-edit-images");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
            for(var i = 0; i < centry.images.length; i++)
            {
                add_collection_image_path(centry.images[i]);
            }
        
            if(centry.date !== '')
            {
                if(centry.date.charAt(0) === '0')
                {
                    document.getElementById("c-edit-date-day").innerText = centry.date.substr(1,1);
                }
                else
                {
                    document.getElementById("c-edit-date-day").innerText = centry.date.substr(0,2);
                }
                if(centry.date.charAt(3) === '0')
                {
                    document.getElementById("c-edit-date-month").innerText = centry.date.substr(4,1);
                }
                else
                {
                    document.getElementById("c-edit-date-month").innerText = centry.date.substr(3,2);
                }
                document.getElementById("c-edit-date-year").innerText = centry.date.substr(6,4);
            }
        
            var radios = document.getElementsByName("c-edit-texture");
            for(var i = 0; i < radios.length; i++)
            {
                if(parseInt(radios[i].value, 10) === centry.texture)
                {
                    radios[i].checked = true;
                }
                else {
                    radios[i].checked = false;
                }
            }
        }
        
        function save_collection_item()
        {
            var entry = get_collection_data();
            if(entry !== false)
            {
                document.getElementById("c-edit-date-day" ).style.boxShadow = "none";
                document.getElementById("c-edit-date-month" ).style.boxShadow = "none";
                document.getElementById("c-edit-date-year" ).style.boxShadow = "none";
                document.getElementById("c-edit-cost" ).style.boxShadow = "none";
                document.getElementById("c-edit-number" ).style.boxShadow = "none";
                document.getElementById("c-edit-order" ).style.boxShadow = "none";
                cancel_item_edit(false);
            }
            return entry;
        }
        
        function save_mineral_item()
        {
            var entry = get_mineral_data();
            if(entry !== false)
            {
                document.getElementById("m-edit-pagenumber" ).style.boxShadow = "none";
                cancel_item_edit(false);
            }
            return entry;
        }
        
        function new_item(table)
        {
            ui.is_new(true);
            program_config.is_new = true;
            change_rightmost_panel(table[0]+"-edit", false, "new_"+table+"_item");
        }
        
        function new_collection_item()
        {
            fill_collection_data(new CollectionEntry());
        }
        
        function new_mineral_item()
        {
            fill_mineral_data(new MineralEntry());
        }
        
        function edit_collection_item()
        {
            fill_collection_data( program_config.active_collection_item );
            change_rightmost_panel("c-edit");
        }
        
        function edit_mineral_item()
        {
            fill_mineral_data( program_config.active_mineral_item );
            change_rightmost_panel("m-edit");
        }
        
        function cancel_item_edit(ask_user)
        {
            // Awesomium wets itself when you give it a function with default parameters, so this line exists instead
            ask_user = (typeof ask_user !== 'undefined') ?  ask_user : true;
        
            if(ask_user)
            {
                ui.confirm("Changes have not been saved - are you sure you want to cancel?", "cancel_item_edit_2", []);
            }
            else
            {
                cancel_item_edit_2();
            }
        }
        
        function cancel_item_edit_2()
        {
            ui.is_new(false);
            program_config.is_new = false;
            if(program_config.table === "Minerals")
            {
                change_rightmost_panel("m-view", true);
            }
            else
            {
                change_rightmost_panel("c-view", true)
            }
        }
        
        function update_mineral_results()
        {
            var columnlist = ["name", "varieties", "description", "colours", "structure", "composition", "images", "category", "pagenumber"];
            var results = document.getElementById("mineral-result-line-container").children;
            for(var i = 0; i < results.length; i++)
            {
                if(results[i].getAttribute("rowid") === program_config.active_mineral_item.rowid.toString())
                {
                    for(var j = 0; j < results[i].children.length; j++)
                    {
                        results[i].children[j].firstChild.firstChild.firstChild.innerText = format_data( program_config.active_mineral_item[columnlist[j]], columnlist[j] );
                    }
                }
            }
        }
        
        function update_collection_results()
        {
            var columnlist = ["number", "order", "name", "type", "description", "colours", "date", "purchaseplace", "notes", "cost", "buyer", "location", "images", "texture"];
            var results = document.getElementById("collection-result-line-container").children;
            for(var i = 0; i < results.length; i++)
            {
                if(results[i].getAttribute("rowid") === program_config.active_collection_item.rowid.toString())
                {
                    for(var j = 0; j < results[i].children.length; j++)
                    {
                        results[i].children[j].firstChild.firstChild.firstChild.innerHTML = format_data( program_config.active_collection_item[columnlist[j]], columnlist[j] );
                    }
                }
            }
        }
        function status(text, bad)
        {
            // Awesomium wets itself when you give it a function with default parameters, so this line exists instead
            bad = (typeof bad !== 'undefined') ?  bad : false;
        
            var statbar = document.getElementById('status-wrapper');
            if(bad)
            {
                statbar.style.color = '#aa0000';
                statbar.innerHTML = 'ERROR: ' + text;
            }
            else
            {
                statbar.style.color = 'black';
                statbar.innerHTML = text;
            }
        }
        
        function show_error_box(errors, filename)
        {
            document.getElementById("add-file-errors-backdrop").style.display = "inline";
            document.getElementById("add-file-error-number").innerHTML = errors.length;
            document.getElementById("add-file-error-name").innerHTML = filename;
            var container = document.getElementById("add-file-error-main");
            var tnode, tdiv;
            for(var i = 0; i < errors.length; i++)
            {
                tnode = document.createTextNode(errors[i]);
                tdiv = document.createElement("div");
        
                tdiv.appendChild(tnode);
                container.appendChild(tdiv);
            }
        }
        
        function show_continue_box(filename)
        {
            document.getElementById("add-file-good-backdrop").style.display = "inline";
            document.getElementById("add-file-good-name").innerHTML = filename;
        }
        
        function get_add_radio_value()
        {
            var radios = document.getElementsByName("fadd-radio");
            for(var i = 0; i < radios.length; i++)
            {
                if(radios[i].checked)
                {
                    return radios[i].value;
                }
            }
            return 0;
        }
        
        function close_addfile_popups()
        {
            document.getElementById("add-file-errors-backdrop").style.display = "none";
            document.getElementById("add-file-good-backdrop").style.display = "none";
            var container = document.getElementById("add-file-error-main");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
        }
        
        function help_popup()
        {
            var help_panel = document.getElementById("id-help-panel");
            help_panel.classList.toggle('show-help-panel');
        }
        
        function change_rightmost_panel(panel, force, callback)
        {
            // Awesomium wets itself when you give it a function with default parameters, so this line exists instead
            force = (typeof force !== 'undefined') ?  force : false
            callback = (typeof callback !== 'undefined') ?  callback : "";
            if(!force)
            {
                if(document.getElementById("edit-mineral-item-panel").style.display === "inline")
                {
                    ui.confirm("Are you sure you want to abandon this edit? All changes will be discarded", "change_rightmost_panel_2", [panel, callback]);
                    return;
                }
                else if(document.getElementById("edit-collection-item-panel").style.display === "inline")
                {
                    ui.confirm("Are you sure you want to abandon this edit? All changes will be discarded", "change_rightmost_panel_2", [panel, callback]);
                    return;
                }
            }
            change_rightmost_panel_2(panel, callback);
        }
        
        function change_rightmost_panel_2(panel, callback)
        {
            callback = (typeof callback !== 'undefined') ?  callback : "";
            document.getElementById("edit-collection-item-panel").style.display = "none";
            document.getElementById("edit-mineral-item-panel").style.display = "none";
            document.getElementById("view-collection-item-panel").style.display = "none";
            document.getElementById("view-mineral-item-panel").style.display = "none";
            switch(panel)
            {
                case "c-view":
                    document.getElementById("view-collection-item-panel").style.display = "inline";
                    break;
                case "m-view":
                    document.getElementById("view-mineral-item-panel").style.display = "inline";
                    break;
                case "c-edit":
                    document.getElementById("edit-collection-item-panel").style.display = "inline";
                    break;
                case "m-edit":
                    document.getElementById("edit-mineral-item-panel").style.display = "inline";
                    break;
            }
            if(callback != "")
            {
                window[callback]();
            }
        
            return true;
        }
        
        window.onclick = function(event)
        {
            // close help window if user clicks outside of it
            if(!(event.target.id === "id-help-panel") && !(event.target.classList.contains("help-button")))
            {
                document.getElementById('id-help-panel').classList.remove('show-help-panel');
            }
            // close the dropdown menu if the user clicks outside of it
            if(!(event.target.id === 'dropdown-arrow-id'))
            {
                undropdown();
            }
        
            var someparent = event.target;
        
            // close the right click menu UNLESS clicking within the menu itself
            while(someparent.parentNode)
            {
                // if the parent is html and loop is still running, the click event is outside the context menu
                if(someparent.tagName === 'HTML')
                {
                    var checkbox = document.getElementById("rclick-context-mineral");
                    if(checkbox.classList.contains("show-checkbox"))
                    {
                        checkbox.classList.remove("show-checkbox");
                    }
                    var checkbox = document.getElementById("rclick-context-collection");
                    if(checkbox.classList.contains("show-checkbox"))
                    {
                        checkbox.classList.remove("show-checkbox");
                    }
                }
        
                // if within the context menu, break the loop (keep menu open)
                if(someparent.id === "rclick-context-mineral")
                {
                    break;
                }
                if(someparent.id === "rclick-context-collection")
                {
                    break;
                }
                someparent = someparent.parentNode;
            }
        }
        function namepart(filepath)
        {
            var n = filepath.lastIndexOf('/');
            return filepath.slice(n + 1);
        }
        
        function list_comp(lst_one, lst_two)
        {
            if(lst_one.length !== lst_two.length) { return false; }
            for(var i = 0; i < lst_one.length; i++)
            {
                if(lst_one[i] !== lst_two[i])
                {
                    return false;
                }
            }
            return true;
        }
        
        function make_date_acceptable(search_form)
        {
            // meaning of return values:
            //    0 means date is unacceptable
            //    anything else means date is fine
        
            var day = '';
            var month = '';
            var year = '';
        
            day   += search_form.elements["date-day-search"].value;
            month += search_form.elements["date-month-search"].value;
            year  += search_form.elements["date-year-search"].value;
        
            if( (day === '') && (month === '') && (year === '') ) return "";
        
            if( !is_integer( day )) return 0;
            if( !is_integer( month )) return 0;
            if( !is_integer( year )) return 0;
        
            if( day === '')
            {
                day = "XX";
            }
            else
            {
                if( parseInt(day, 10) > 31 ) return 0;
                if( parseInt(day, 10) < 1 ) return 0;
            }
        
            if( month === '')
            {
                month = "XX";
            }
            else
            {
                if( parseInt(month, 10) > 12 ) return 0;
                if( parseInt(month, 10) < 1 ) return 0;
            }
        
            if( year === '')
            {
                year = "XXXX";
            }
            else
            {
                if( parseInt(year, 10) === 0 ) return 0;
                if( year.length !== 4 ) return 0;
            }
        
            if(day.length === 1) day = "0" + day;
            if(month.length === 1) month = "0" + month;
        
            return (day + "-" + month + "-" + year);
        }
        
        function subscript_numbers(raw)
        {
            var output = "";
            var insertafter = false;
            var digits = "0123456789";
            for(var i = 0; i < raw.length; i++)
            {
                if((digits.indexOf(raw[i]) === -1) && (insertafter)) // if n is a letter and a <sub> needs closing
                {
                    output += "</sub>";
                    insertafter = false;
                }
                if((digits.indexOf(raw[i]) !== -1) && (!insertafter)) // if n is the first digit of a number
                {
                    output += "<sub>";
                    insertafter = true;
                }
                i
                output += raw[i];
            }
            if(insertafter)
            {
                output += "</sub>";
            }
            return output;
        }
        
        function anti_subscript_numbers(raw)
        {
            raw = raw.replace(/<div>/g, "");
            return raw.replace(/<\/div>/g, "");
        }
        
        function parseNum(value)
        {
            if(value === '') return -1;
            if(!is_integer(value)) return -1;
            return parseInt(value, 10);
        }
        
        function list_to_string(l, concat)
        {
            concat = (typeof concat !== 'undefined') ?  concat : ", ";
            var res = '';
            for(var i = 0; i < l.length; i++)
            {
                res += l[i] + concat;
            }
            res = res.slice(0, (-1*concat.length));
            return res;
        }
        
        function full_date(datestring, abbrev)
        {
            // Awesomium wets itself when you give it a function with default parameters, so this line exists instead
            abbrev = (typeof abbrev !== 'undefined') ?  abbrev : false;
        
            var full_date = '';
            var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        
            var day = datestring.substr(0,2);
        
            if(day[0] === '0')
            {
                full_date = day[1];
            }
            else
            {
                full_date = day;
            }
        
            if(day[0] === '1')
            {
                full_date += 'th ';
            }
            else if(day[1] === '1')
            {
                full_date += 'st ';
            }
            else if(day[1] === '2')
            {
                full_date += 'nd ';
            }
            else if(day[1] === '3')
            {
                full_date += 'rd ';
            }
            else
            {
                full_date += 'th ';
            }
        
            var month = '';
            if(abbrev)
            {
                month = months[parseInt(datestring.substr(3,5), 10) - 1].substr(0,3);
            }
            else
            {
                month = months[parseInt(datestring.substr(3,5), 10) - 1];
            }
            full_date += month + ' ';
        
            full_date +=  datestring.substr(6,10);
        
            return full_date;
        }
        
        function pence_to_pounds(pence, prefix)
        {
            prefix = (typeof prefix !== 'undefined') ?  prefix : "&pound;";
            var money = '';
        
            if(pence < 100)
            {
                money = pence + "p";
                return money;
            }
        
            money += (pence/100).toString();
        
            // works out the log to base 10 of the number, which is equal to the number of figures before the decimal point minus 1
            // this was intended to use Math.log10, but this caused crashes for some reason
            // now using the change of base formula, as Math.log() works fine
            var beforepoint = Math.floor(Math.log(pence/100) / Math.log(10));
            if(beforepoint < 0) beforepoint = 0; // 0 means that the number is < 10
        
            // crop the string to 2 decimal places
            // reason for the +4:
            //   beforepoint is equal to number of figures before the decimal point minus 1, so add 1 to make up for that
            //   1 is added because of the decimal point
            //   2 is added for the 2 decimal places
            money = money.substr(0, beforepoint + 4);
        
            if( (pence/100) !== (Math.floor(pence/100)))
            {
                // only add zeroes if the number has a number of pence, i.e. pence/100 is not an integer
                while(money.length < beforepoint + 4)
                {
                    money += "0"; // add zeroes on the end because aesthetics
                }
            }
        
            money = prefix + money; // add pound sign
        
            return money; // if only...
        }
        
        function display_list(var_list)
        {
            var res = '';
            if(var_list.length < 1)
            {
                return res;
            }
            if(var_list.length === 1)
            {
                res += var_list[0];
                return res;
            }
            for(var i = 0; i < var_list.length - 2; i++)
            {
                res += var_list[i];
                res += ', ';
            }
            res += var_list[var_list.length - 2];
            res += ' and ';
            res += var_list[var_list.length - 1];
        
            return res;
        }
        
        function explode(s, c)
        {
            // splits a string s on c
            // for example, explode("list,of,words",',') returns ["list","of","words"]
            // function ignores any instances of c inside double quotes
        
        	var buffer = ''; // stores current word
        	var v = []; // output
        	var track = true; // keeps track of whether the loop is in a double quote pair or not
        
        	for(var i = 0; i < s.length; i++) // iterate through s
        	{
        	    if(s[i] === '\"')
                {
                    track = !track; // we have just entered/left a quote pair
                }
        	    if(!track)
                {
                    buffer += s[i]; // if in quote pair, add n to buffer regardless
                    continue; // skip any further comparisons
                }
        		if(s[i] !== c)
                {
                    buffer += s[i]; // if n is not c, add to buffer
                }
                else if((s[i] === c) && (buffer !== "") && track)
                {
                    v.push(buffer); // if n is c, add buffer to output
                    buffer = ''; // reset buffer
                }
        	}
        	if(buffer !==  '') // if there is something in the buffer
            {
                v.push(buffer); // add whatever buffer is to output
            }
        
            // remove trailing whitespace from array elements
            for(var j = 0; j < v.length; j++)
            {
                v[j] = v[j].replace(/&nbsp;/g, " ");
                while(v[j].charAt(0) === ' ')
                {
                    v[j] = v[j].slice(1);
                }
                while(v[j].slice(-1) === ' ')
                {
                    v[j] = v[j].slice(0, -1);
                }
            }
        
        	return v;
        }
        
        function is_integer(s, allow_void)
        {
            // checks if s contains only numbers, i.e. s is an integer
            // by default, '~' is accepted, which is translated as NULL
        
            // Awesomium wets itself when you give it a function with default parameters, so this line exists instead
            allow_void = (typeof allow_void !== 'undefined') ?  allow_void : true;
        
            if(s == "~" && allow_void)
            {
                return true;
            }
            var digits = "0123456789";
            for(var i = 0; i < s.toString().length; i++) // iterate through s
            {
                if(digits.indexOf(s.toString()[i]) === -1) // if n is not a number
                {
                    ui.printmsg("the offending char is '"+s.toString()[i]+"'");
                    return false;
                }
            }
            return true; // s is a number
        }
        
        function is_antinumber(s)
        {
            // opposite of is_integer - returns false if s contains any numbers
        
            var digits = "0123456789";
            for(var i = 0; i < s.length; i++) // iterate through the string
            {
                if(digits.indexOf(s[i]) !== -1) // n is a number! D:
                {
                    return false;
                }
            }
            return true; // no number here
        }
        
        function censor(word)
        {
            if(word == null) { return ''; }
            var valid_chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
        
            var result = '';
        
            for(var i = 0; i < word.length; i++)
            {
                if(valid_chars.indexOf(word[i]) !== -1)
                {
                    result += word[i];
                }
            }
        
            return result;
        }
        
        function reset_collection_object(obj)
        {
            obj.rowid = -1;
            obj.number = -1;
            obj.order = '';
            obj.name = '';
            obj.type = [];
            obj.description = '';
            obj.colours = [];
            obj.date = '';
            obj.purchaseplace = '';
            obj.notes = '';
            obj.cost = -1;
            obj.buyer = '';
            obj.location = '';
            obj.images = [];
            obj.texture = -1;
        }
        
        function reset_mineral_object(obj)
        {
            obj.rowid = -1;
            obj.name = '';
            obj.varieties = [];
            obj.description = '';
            obj.colours = [];
            obj.structure = '';
            obj.composition = '';
            obj.images = [];
            obj.category = '';
            obj.pagenumber = -1;
        }
        
        function push_to_list(config_property, value)
        {
            var temp = program_config[config_property];
            temp.push(value);
            program_config[config_property] = temp;
            ui.sync_item(config_property, temp);
            return temp;
        }
        
        function modify_list(config_property, index, value)
        {
            var temp = program_config[config_property];
            temp[index] = value;
            program_config[config_property] = temp;
            ui.sync_item(config_property, temp);
            return temp;
        }
        
        function remove_one_item(config_property, index)
        {
            var temp = program_config[config_property];
            temp.splice(index, 1);
            program_config[config_property] = temp;
            ui.sync_item(config_property, temp);
            return temp;
        }
        function show_confirm_box(message, cpp_callback, js_callback, js_args, cpp_arg)
        {
            document.getElementById("confirm-box-backdrop").style.display = "inline";
            document.getElementById("confirm-box-text").innerHTML = message;
            if(typeof cpp_arg !== 'undefined')
            {
                document.getElementById("confirm-box-go").onclick = function() { ui[cpp_callback](cpp_arg, true, js_callback, js_args) };
                document.getElementById("confirm-box-cancel").onclick = function() { ui[cpp_callback](cpp_arg, false) };
            }
            else
            {
                document.getElementById("confirm-box-go").onclick = function() { ui[cpp_callback](true, js_callback, js_args) };
                document.getElementById("confirm-box-cancel").onclick = function() { ui[cpp_callback](false) };
            }
        }
        
        function show_prompt_box(message, callback)
        {
            document.getElementById("prompt-box-text").style.boxShadow = "none";
            document.getElementById("prompt-box-backdrop").style.display = "inline";
            document.getElementById("prompt-box-text").innerHTML = message;
            document.getElementById('prompt-box-input').innerHTML = '';
            document.getElementById('prompt-box-input').contentEditable = true;
            document.getElementById('prompt-box-input').focus();
            document.getElementById("prompt-box-go").onclick = function() { ui[callback](document.getElementById('prompt-box-input').innerHTML) };
            document.getElementById("prompt-box-cancel").onclick = function() { ui[callback](false) };
        }
        
        function bad_table_name(message)
        {
            document.getElementById("prompt-box-text").innerHTML = message;
            redbox('prompt-box-input');
        }
        
        function hide_message_boxes()
        {
            document.getElementById("prompt-box-backdrop").style.display = "none";
            document.getElementById("confirm-box-backdrop").style.display = "none";
        }
        function activate_arrow(table, direction)
        {
            var arrow = document.getElementById(table+"-image-arrow-"+direction);
        
            arrow.src = "resource/arrow_" + direction + ".png";
            arrow.style.cursor = "pointer";
        }
        
        function deactivate_arrow(table, direction)
        {
            var arrow = document.getElementById(table+"-image-arrow-"+direction);
        
            arrow.src = "resource/arrow_" + direction + "_null.png";
            arrow.style.cursor = "default";
        }
        
        function advance_image(identifier)
        {
            var image_list = program_config["active_"+identifier+"_item"].images;
        
            if(program_config[identifier+"_current_image"] < image_list.length - 1)
            {
                var temp = program_config[identifier+"_current_image"] + 1;
                program_config[identifier+"_current_image"]++;
        
                document.getElementById(identifier + "-image").style.backgroundImage = "url('"+program_config.image_path+image_list[temp] + "')";
                document.getElementById(identifier + "-image-count").innerHTML = (temp + 1) + "/" + image_list.length;
        
                activate_arrow(identifier, "left");
                if(temp === image_list.length - 1)
                {
                    deactivate_arrow(identifier, "right");
                }
                else
                {
                    activate_arrow(identifier, "right");
                }
            }
            return temp;
        }
        
        function decrement_image(identifier)
        {
            var image_list = program_config["active_"+identifier+"_item"].images;
        
            if(program_config[identifier+"_current_image"] > 0)
            {
                temp = program_config[identifier+"_current_image"] - 1;
                program_config[identifier+"_current_image"]--;
        
                document.getElementById(identifier + "-image").style.backgroundImage = "url('"+program_config.image_path+image_list[temp] + "')";
                document.getElementById(identifier + "-image-count").innerHTML = (temp + 1) + "/" + image_list.length;
        
                activate_arrow(identifier, "right");
                if(temp === 0)
                {
                    deactivate_arrow(identifier, "left");
                }
                else
                {
                    activate_arrow(identifier, "left");
                }
            }
            return temp;
        }
        
        function display_mineral_item()
        {
            var mineral_current_image = -1;
            mineral_current_image = program_config.mineral_current_image;
        
            var m_item = program_config.active_mineral_item;
            var displaybox;
        
            if(m_item.colours.length > 0) { document.getElementById("view-min-colours-label").style.display = "inline"; }
            else { document.getElementById("view-min-colours-label").style.display = "none"; }
            if(m_item.varieties.length > 0) { document.getElementById("view-min-varieties-label").style.display = "inline"; }
            else { document.getElementById("view-min-varieties-label").style.display = "none"; }
            if(m_item.pagenumber != -1) { document.getElementById("view-min-pagenum-label").style.display = "inline"; }
            else { document.getElementById("view-min-pagenum-label").style.display = "none"; }
            if(m_item.category != "") { document.getElementById("view-min-category-label").style.display = "inline"; }
            else { document.getElementById("view-min-category-label").style.display = "none"; }
        
            // set name
            displaybox = document.getElementById("mineral-item-name");
            displaybox.innerHTML = '';
            displaybox.innerHTML = m_item.name;
        
            displaybox = document.getElementById("mineral-item-strucformula");
            displaybox.innerHTML = '';
            if(m_item.structure !== '')
            {
                displaybox.innerHTML = m_item.structure;
                displaybox.innerHTML += ' ';
            }
            displaybox.innerHTML += subscript_numbers(m_item.composition);
        
            displaybox = document.getElementById("mineral-item-description");
            displaybox.innerHTML = '';
            displaybox.innerHTML = m_item.description;
        
            displaybox = document.getElementById("mineral-item-varieties");
            displaybox.innerHTML = '';
            displaybox.innerHTML = display_list(m_item.varieties);
        
            displaybox = document.getElementById("mineral-item-nickelstrunz");
            displaybox.innerHTML = '';
            displaybox.innerHTML = m_item.category;
        
            displaybox = document.getElementById("mineral-item-pagenum");
            displaybox.innerHTML = '';
            if(m_item.pagenumber !== -1)
            {
                displaybox.innerHTML = m_item.pagenumber;
            }
        
            displaybox = document.getElementById("mineral-item-colours");
            displaybox.innerHTML = '';
            displaybox.innerHTML = display_list(m_item.colours);
        
            // show images and image info
            if(m_item.images.length === 0)
            {
                program_config.mineral_current_image = -1;
                document.getElementById("mineral-image").style.backgroundImage = "url('resource/placeholder.png')";
                document.getElementById("mineral-image-count").innerHTML = "0/0";
                deactivate_arrow("mineral", "left");
                deactivate_arrow("mineral", "right");
            }
            else
            {
                if(mineral_current_image === -1)
                {
                    mineral_current_image = 0;
                    program_config.mineral_current_image = mineral_current_image;
                }
        
                var imgpath = "url('" + (program_config.image_path) + m_item.images[mineral_current_image] + "')";
                document.getElementById("mineral-image").style.backgroundImage = imgpath;
        
                document.getElementById("mineral-image-count").innerHTML = (mineral_current_image + 1) + "/" + m_item.images.length;
                deactivate_arrow("mineral", "left");
                deactivate_arrow("mineral", "right");
        
                if((mineral_current_image + 1) < m_item.images.length)
                {
                    activate_arrow("mineral", "right");
                }
                if((mineral_current_image + 1) > 1)
                {
                    activate_arrow("mineral", "left");
                }
            }
            ui.sync_item("mineral_current_image", mineral_current_image);
            return 0;
        }
        
        function display_collection_item()
        {
            collection_current_image = -1;
            collection_current_image = program_config.collection_current_image;
        
            var c_item = program_config.active_collection_item
        
            if(c_item.colours.length > 0) { document.getElementById("view-coll-colours-label").style.display = "inline"; }
            else { document.getElementById("view-coll-colours-label").style.display = "none"; }
        
            var displaybox;
        
            // set top line information (number, order, name)
            displaybox = document.getElementById("collection-item-name");
            displaybox.innerHTML = '';
        
            if(c_item.number !== -1)
            {
                displaybox.innerHTML = c_item.number;
            }
            displaybox.innerHTML += c_item.order;
        
            var add_structure = ( c_item.number !== -1 ) || ( c_item.order !== '' );
            if(add_structure)
            {
                displaybox.innerHTML += '. ';
            }
        
            displaybox.innerHTML += c_item.name;
        
            // show mineral types present
            displaybox = document.getElementById("collection-item-type");
            displaybox.innerHTML = '';
            displaybox.innerHTML = display_list(c_item.type);
        
            // description
            displaybox = document.getElementById("collection-item-description");
            displaybox.innerHTML = '';
            displaybox.innerHTML = c_item.description;
        
            // notes
            displaybox = document.getElementById("collection-item-notes");
            displaybox.innerHTML = '';
            displaybox.innerHTML = c_item.notes;
        
            // display purchase info (place of purchase, date, buyer, cost)
            displaybox = document.getElementById("collection-item-purchase");
            displaybox.innerHTML = '';
        
            add_structure = ( ( c_item.date !== "" ) || ( c_item.buyer !== "" ) ) || ( ( c_item.purchaseplace !== "" ) || ( c_item.cost !== -1 ) );
        
            if(add_structure)
            {
                displaybox.innerHTML = "Bought";
            }
            if(c_item.purchaseplace !== "")
            {
                displaybox.innerHTML += " in ";
                displaybox.innerHTML += c_item.purchaseplace;
            }
            if(c_item.buyer !== "")
            {
                displaybox.innerHTML += " by ";
                displaybox.innerHTML += c_item.buyer;
            }
            if(c_item.date !== "")
            {
                displaybox.innerHTML += " on the ";
                displaybox.innerHTML += full_date(c_item.date);
            }
            if(c_item.cost !== -1)
            {
                displaybox.innerHTML += " for ";
                displaybox.innerHTML += pence_to_pounds(c_item.cost);
            }
        
            // show list of colours
            displaybox = document.getElementById("collection-item-colours");
            displaybox.innerHTML = '';
            displaybox.innerHTML = display_list(c_item.colours);
        
            // show current location
            displaybox = document.getElementById("collection-item-location");
            displaybox.innerHTML = '';
            if(c_item.location !== "")
            {
                displaybox.innerHTML = "Lives in the " + c_item.location;
            }
        
            // show the texture of the stone
            displaybox = document.getElementById("collection-item-texture");
            displaybox.innerHTML = '';
            if(c_item.texture === 1)
            {
                displaybox.innerHTML = "Tumbled stone";
            }
            else if(c_item.texture === 0)
            {
                displaybox.innerHTML = "Rough stone";
            }
        
            // show images and image info
            if(c_item.images.length === 0)
            {
                program_config.collection_current_image = -1;
                document.getElementById("collection-image").style.backgroundImage = "url('resource/placeholder.png')";
                document.getElementById("collection-image-count").innerHTML = "0/0";
                deactivate_arrow("collection", "left");
                deactivate_arrow("collection", "right");
            }
            else
            {
                if(collection_current_image === -1)
                {
                    collection_current_image = 0
                    program_config.collection_current_image = 0;
                }
                document.getElementById("collection-image").style.backgroundImage = "url('"+program_config.image_path+ c_item.images[collection_current_image] + "')";
                document.getElementById("collection-image-count").innerHTML = (collection_current_image + 1) + "/" + c_item.images.length;
                deactivate_arrow("collection", "left");
                deactivate_arrow("collection", "right");
                if((collection_current_image + 1) < c_item.images.length)
                {
                    activate_arrow("collection", "right");
                }
                if((collection_current_image + 1) > 1)
                {
                    activate_arrow("collection", "left");
                }
            }
            ui.sync_item("collection_current_image", collection_current_image);
            return 0;
        }
        
        function confirm_delete_item(type)
        {
            ui.confirm("Are you sure you want to delete this item?", "delete_"+type+"_item", []);
        }
        
        function delete_collection_item()
        {
            var a = ui.delete_collection_item();
            if(a)
            {
                status("Item deletion unsuccessful", true);
                return 1;
            }
        
            var results = document.getElementById("collection-result-line-container").children;
            for(var i = 0; i < results.length; i++)
            {
                if(results[i].getAttribute("rowid") === program_config.active_collection_item.rowid.toString())
                {
                    results[i].parentNode.removeChild(results[i]);
                }
            }
        
            reset_collection_object(program_config.active_collection_item);
            display_collection_item();
            var resultlines = document.getElementById("collection-result-line-container").children;
            for(var i = 0; i < resultlines.length; i++)
            {
                if(i % 2 === 1)
                {
                     resultlines[i].classList.add("result-grey-background");
                }
                else
                {
                     resultlines[i].classList.remove("result-grey-background");
                }
            }
            status("Item deleted");
        }
        
        function delete_mineral_item()
        {
            var a = ui.delete_mineral_item();
            if(a)
            {
                status("Item deletion unsuccessful", true);
                return 1;
            }
        
            var results = document.getElementById("mineral-result-line-container").children;
            for(var i = 0; i < results.length; i++)
            {
                if(results[i].getAttribute("rowid") === program_config.active_mineral_item.rowid.toString())
                {
                    results[i].parentNode.removeChild(results[i]);
                }
            }
        
            reset_mineral_object(program_config.active_mineral_item);
            display_mineral_item();
            var resultlines = document.getElementById("mineral-result-line-container").children;
            for(var i = 0; i < resultlines.length; i++)
            {
                if(i % 2 === 1)
                {
                     resultlines[i].classList.add("result-grey-background");
                }
                else
                {
                     resultlines[i].classList.remove("result-grey-background");
                }
            }
            status("Item deleted");
        }
        function move_element_down(element)
        {
            if (element.nextElementSibling)
            {
                element.parentElement.insertBefore(element, element.nextElementSibling.nextElementSibling);
            }
        }
        
        function sort_mineral_items()
        {
            var itemlist = document.getElementById("mineral-result-line-container").children;
            var track_ids = [];
        
            for(var k = 0; k < itemlist.length; k++)
            {
                track_ids.push(parseInt(itemlist[k].getAttribute("rowid"),10));
            }
        
            while(!list_comp(track_ids, program_config.minerals_results.results))
            {
                for(var j = 0; j < itemlist.length; j++)
                {
                    if(track_ids[j] !== program_config.minerals_results.results[j])
                    {
                        track_ids[j] = track_ids[j + 1] ^ track_ids[j];
                        track_ids[j + 1]     = track_ids[j + 1] ^ track_ids[j];
                        track_ids[j] = track_ids[j + 1] ^ track_ids[j];
                        move_element_down(itemlist[j]);
                        if(track_ids[j + 1] === program_config.minerals_results.results[j + 1])
                        {
                            break;
                        }
                    }
                }
            }
        }
        
        function sort_collection_items()
        {
            var itemlist = document.getElementById("collection-result-line-container").children;
            var track_ids = [];
        
            for(var k = 0; k < itemlist.length; k++)
            {
                track_ids.push(parseInt(itemlist[k].getAttribute("rowid"),10));
            }
        
            while(!list_comp(track_ids, program_config.collection_results.results))
            {
                for(var j = 0; j < itemlist.length; j++)
                {
                    if(track_ids[j] !== program_config.collection_results.results[j])
                    {
                        track_ids[j] = track_ids[j + 1] ^ track_ids[j];
                        track_ids[j + 1]     = track_ids[j + 1] ^ track_ids[j];
                        track_ids[j] = track_ids[j + 1] ^ track_ids[j];
                        move_element_down(itemlist[j]);
                        if(track_ids[j + 1] === program_config.collection_results.results[j + 1])
                        {
                            break;
                        }
                    }
                }
            }
        }
        function CollectionEntry()
        {
            this.rowid = -1;
            this.number = -1;
            this.order = '';
            this.name = '';
            this.type = [];
            this.description = '';
            this.colours = [];
            this.date = '';
            this.purchaseplace = '';
            this.notes = '';
            this.cost = -1;
            this.buyer = '';
            this.location = '';
            this.images = [];
            this.texture = -1;
        }
        
        function MineralEntry()
        {
            this.rowid = -1;
            this.name = '';
            this.varieties = [];
            this.description = '';
            this.colours = [];
            this.structure = '';
            this.composition = '';
            this.images = [];
            this.category = '';
            this.pagenumber = -1;
        }
        
        function SearchResult()
        {
            this.tablename = '';
            this.results = [];
            this.active_item = -1;
            this.sort_mask = 0; // 0=name, 1=purchase number, 2=date, 3=cost, 4=mineral type. for the Minerals table, only name applies
            this.sort_ascending = true;
            this.search_or = false; // false = AND, true = OR when searching
            this.datecomp = 0; // not applicable to Minerals table
            this.costcomp = 0; // ditto
            this.numcomp  = 0; // ditto
        }
        
        /*function ProgramConfig()
        {
            this.table = '';
            this.collection_table = '';
            this.collection_table_list = [];
            this.active_item_table = '';
        
            this.collection_results = new SearchResult();
            this.minerals_results = new SearchResult();
            this.active_collection_item = new CollectionEntry();
            this.active_mineral_item = new MineralEntry();
            this.alternate_table_info = [];
        
            this.collection_current_image = -1;
            this.mineral_current_image = -1;
        
            this.visible_collection_columns = [];
            this.collection_column_widths = [];
        
            this.visible_mineral_columns = [];
            this.mineral_column_widths = [];
        }
        */
        function resizer(resizerElement)
        {
            // add event listeners to resize regions
        
            resizerElement.mousemove = function(e)
            {
                var colTarget = this.parentElement.classList[1];
                resizeX(colTarget, e.pageX + 3); // resize box with 3px offset to keep cursor in the middle of the resize region
            }
        
            resizerElement.onmousedown = function(e)
            {
                document.documentElement.addEventListener('mousemove', resizerElement.dragging, false); // add listener for mouse dragging when the drag region has been clicked
                document.documentElement.addEventListener('mouseup', resizerElement.enddrag, false); // add listener for mouseup event
                if(e.preventDefault) e.preventDefault(); // stop bubbling of event to disable text selection while dragging
            }
        
            resizerElement.dragging = function(e)
            {
                if (e.which != 1)
                {
                    resizerElement.enddrag(e); // end of dragging process
                    return;
                }
                resizerElement.mousemove(e); // whlie dragging, resize box to new cursor position
            }
        
            resizerElement.enddrag = function(e)
            {
                var sizelist = [];
                var percentwidth = 0;
                var tableid = "mineral";
                for(var i = 0; i < this.parentElement.classList.length; i++)
                {
                    if(this.parentElement.classList[i].substr(1,4) === "col-")
                    {
                        if(this.parentElement.classList[i].substr(0,1) === "c")
                        {
                            tableid = "collection";
                        }
                    }
                }
        
                for(var o = 0; o < program_config["visible_"+tableid+"_columns"].length; o++)
                {
                    sizelist.push("");
                }
                var topbar = document.getElementById(tableid+"-results-topbar");
                for( var j = 0; j < topbar.children.length; j++ )
                {
                    var colindex = program_config["visible_"+tableid+"_columns"].indexOf(topbar.children[j].id.substr(5));
                    if(colindex !== -1)
                    {
                        percentwidth = ((topbar.children[j].offsetWidth*100)/topbar.offsetWidth).toString()+"%";
                        sizelist[colindex] = percentwidth;
                    }
                }
                ui.sync_item(tableid+"_column_widths", sizelist);
                document.documentElement.removeEventListener('mouseup', resizerElement.enddrag, false); // ditto for mouseup
                document.documentElement.removeEventListener('mousemove', resizerElement.dragging, false); // when mouseup, stop listening for mouse drag
            }
        }
        
        function attach_drag_handlers()
        {
            var resizeList = document.getElementsByClassName('resize-region');
            for(var i = 0; i < resizeList.length; i++)
            {
                resizer(resizeList[i]);
            }
            return 0;
        }
        
        function resizeX(columnClass, x)
        {
            var columns = document.getElementsByClassName(columnClass);
            var barwidth = 0;
            var index = 0;
            if(columnClass.substr(0,1) == "m")
            {
                barwidth = document.getElementById("mineral-results-topbar").offsetWidth;
            }
            else
            {
                barwidth = document.getElementById("collection-results-topbar").offsetWidth;
            }
        
            var rElem, rect;
            for(var i = 0; i < columns.length; i++)
            {
                rElem = columns[i];
                rect = rElem.getBoundingClientRect(); // get position info for label
                if((x - rect.left) >= 21)
                {
                    rElem.style.width = (x - rect.left)*(100/barwidth) + '%'; // set new width to cursor position minus box position
                }
            }
            if(columnClass.substr(0,1) == "m")
            {
                index = program_config.visible_mineral_columns.indexOf(columnClass.substr(5));
                modify_list(program_config.mineral_column_widths, index, (x - rect.left)*(100/barwidth) + '%')
            }
            else
            {
                index = program_config.visible_collection_columns.indexOf(columnClass.substr(5));
                modify_list(program_config.collection_column_widths, index, (x - rect.left)*(100/barwidth) + '%')
            }
        }
        function format_data(raw, col)
        {
            var list_types = ["colours", "varieties", "type"];
            var pos = list_types.indexOf(col);
        
            if(raw === -1) return '';
        
            if(pos !== -1)
            {
                return display_list(raw);
            }
            if(col === "images")
            {
                return raw.length;
            }
            if(col === "date")
            {
                if(raw === '') return raw;
                return full_date(raw, true);
            }
            if(col === "composition")
            {
                return subscript_numbers(raw);
            }
            if(col === "cost")
            {
                return pence_to_pounds(raw);
            }
            if(col === "texture")
            {
                if(raw === 1) return "Tumbled";
                if(raw === 0) return "Rough";
            }
            return raw;
        }
        
        function add_mineral_result(mineral_data, position)
        {
            position = (typeof position !== 'undefined') ? position : 0;
        
            var external = false;
            mineral_data_list = [];
            var columnlist = ["name", "varieties", "description", "colours", "structure", "composition", "images", "category", "pagenumber"];
            //if(mineral_data_list.length === 10)
            if(typeof mineral_data === "string")
            {
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [2, 0, 1, 0, 1, 0, 0, 4, 0, 2];
                var conversion = ["empty_return", "seperate_commas", "to_integer", "to_integer_list", "seperate_images", "to_boolean"];
                var item = 0;
                var temp = "";
        
                for(var i = 0; i < mineral_data.length; i++)
                {
                    if(String(mineral_data[i]) === String.fromCharCode(0x1E))
                    {
                        mineral_data_list.push( window[conversion[conversion_code[item]]](temp) );
                        temp = '';
                        item++;
                    }
                    else
                    {
                        temp += mineral_data[i];
                    }
                }
                mineral_data_list.push( window[conversion[conversion_code[item]]](temp) );
                external = true;
            }
        
            var newline = document.createElement("div");
            newline.classList.add("result-line", "mineral-result");
        
            if(external)
            {
                newline.setAttribute("rowid", mineral_data_list[0]);
            }
            else
            {
                newline.setAttribute("rowid", mineral_data_list.rowid);
            }
        
            var newcol, tnode, nesttable, nesttr, nesttd;
        
            for(var i = 0; i < columnlist.length; i++)
            {
                //ui.printmsg("'"+columnlist[i]+"' :: "+mineral_data_list[ i + 1 ] );
                newcol = document.createElement("div");
                newcol.classList.add("mres-"+columnlist[i]);
                newcol.classList.add("mcol-"+columnlist[i]);
        
                tnode = document.createTextNode("");
                nesttable = document.createElement("table");
                nesttr = document.createElement("tr");
                nesttd = document.createElement("td");
        
                nesttable.classList.add("result-cell-wrapper");
                nesttd.classList.add("result-cell-text");
        
                nesttd.appendChild(tnode);
                nesttr.appendChild(nesttd);
                nesttable.appendChild(nesttr);
                newcol.appendChild(nesttable);
        
                if(external)
                {
                    nesttd.innerHTML = format_data(mineral_data_list[ i + 1 ], columnlist[i] );
        
                }
                else
                {
                    nesttd.innerHTML = format_data(mineral_data_list[ columnlist[i] ], columnlist[i] );
                }
        
                newcol.style.width = document.getElementById("mlab-"+columnlist[i]).style.width;
        
                var query_columns = document.getElementsByClassName("sorting-tab mcol-"+columnlist[i]);
        
                if(query_columns[0].classList.contains("show-column"))
                {
                    newcol.classList.add("show-column");
                }
        
                newline.appendChild(newcol);
            }
        
            newline.onclick = function(){ui.activate_mineral_item(this.getAttribute("rowid"))};
        
            if(position % 2 === 1)
            {
                 newline.classList.add("result-grey-background");
            }
        
            document.getElementById("mineral-result-line-container").appendChild(newline);
        }
        
        function add_collection_result(collection_data, position)
        {
            position = (typeof position !== 'undefined') ?  position : 0;
        
            var external = false;
            collection_data_list = [];
            var columnlist = ["number", "order", "name", "type", "description", "colours", "date", "purchaseplace", "notes", "cost", "buyer", "location", "images", "texture"];
            //if(collection_data.length === 15)
            if(typeof collection_data === "string")
            {
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [2, 2, 0, 0, 1, 0, 1, 0, 0, 0, 2, 0, 0, 4, 2];
                var conversion = ["empty_return", "seperate_commas", "to_integer", "to_integer_list", "seperate_images", "to_boolean"];
                var item = 0;
                var temp = "";
        
                for(var i = 0; i < collection_data.length; i++)
                {
                    if(String(collection_data[i]) === String.fromCharCode(0x1E))
                    {
                        collection_data_list.push( window[conversion[conversion_code[item]]](temp) );
                        temp = '';
                        item++;
                    }
                    else
                    {
                        temp += collection_data[i];
                    }
                }
                collection_data_list.push( window[conversion[conversion_code[item]]](temp) );
                external = true;
            }
        
            var newline = document.createElement("div");
            newline.classList.add("result-line", "collection-result");
        
            if(external)
            {
                newline.setAttribute("rowid", collection_data_list[0]);
            }
            else
            {
                newline.setAttribute("rowid", collection_data.rowid);
            }
        
            var newcol, tnode, nesttable, nesttr, nesttd;
            for(var i = 0; i < columnlist.length; i++)
            {
                //ui.printmsg("'"+columnlist[i]+"' :: "+collection_data_list[ i + 1 ] );
                newcol = document.createElement("div");
        
                newcol.classList.add("cres-"+columnlist[i]);
                newcol.classList.add("ccol-"+columnlist[i]);
        
                tnode = document.createTextNode("");
                nesttable = document.createElement("table");
                nesttr = document.createElement("tr");
                nesttd = document.createElement("td");
        
                nesttable.classList.add("result-cell-wrapper");
                nesttd.classList.add("result-cell-text");
        
                nesttd.appendChild(tnode);
                nesttr.appendChild(nesttd);
                nesttable.appendChild(nesttr);
                newcol.appendChild(nesttable);
        
                if(external)
                {
                    nesttd.innerHTML = format_data( collection_data_list[ i + 1 ], columnlist[i] );
                }
                else
                {
                    nesttd.innerHTML = format_data( collection_data_list[ columnlist[i] ], columnlist[i] );
                }
        
                newcol.style.width = document.getElementById("clab-"+columnlist[i]).style.width;
        
                var query_columns = document.getElementsByClassName("sorting-tab ccol-"+columnlist[i])
                if(query_columns[0].classList.contains("show-column"))
                {
                    newcol.classList.add("show-column");
                }
        
                newline.appendChild(newcol);
            }
        
            newline.onclick = function(){ui.activate_collection_item(this.getAttribute("rowid"))};
        
            if(position % 2 === 1)
            {
                 newline.classList.add("result-grey-background");
            }
        
            document.getElementById("collection-result-line-container").appendChild(newline);
        }
        
        function show_collection_context(x, y)
        {
            var context_menu = document.getElementById('rclick-context-collection');
            if(!context_menu.classList.contains("show-checkbox"))
            {
                context_menu.classList.add("show-checkbox");
            }
            context_menu.style.top = y + 'px';
            context_menu.style.left = x + 'px';
        }
        
        function show_mineral_context(x, y)
        {
            var context_menu = document.getElementById('rclick-context-mineral');
            if(!context_menu.classList.contains("show-checkbox"))
            {
                context_menu.classList.add("show-checkbox");
            }
            context_menu.style.top = y + 'px';
            context_menu.style.left = x + 'px';
        }
        
        function add_context_listeners()
        {
            document.getElementById("collection-results-topbar").addEventListener('contextmenu', function(event)
                                                                                                 {
                                                                                                     event.preventDefault();
                                                                                                     show_collection_context(event.pageX, event.pageY);
                                                                                                     return false;
                                                                                                 }, false);
            document.getElementById("mineral-results-topbar").addEventListener('contextmenu', function(event)
                                                                                                 {
                                                                                                     event.preventDefault();
                                                                                                     show_mineral_context(event.pageX, event.pageY);
                                                                                                     return false;
                                                                                                 }, false);
            return 0;
        }
        
        function remove_collection_results()
        {
            var container = document.getElementById("collection-result-line-container");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
        }
        
        function remove_mineral_results()
        {
            var container = document.getElementById("mineral-result-line-container");
            while (container.firstChild)
            {
                container.removeChild(container.firstChild);
            }
        }
        
        function total_length(toResize)
        {
            var total = 0;
            for(var i = 0; i < toResize.length; i++)
            {
                total += toResize[i].offsetWidth;
            }
            return total;
        }
        
        function toggle_mineral_column(checkid)
        {
            visible_mineral_columns = program_config.visible_mineral_columns;
            mineral_column_widths = program_config.mineral_column_widths;
        
            checkid = "mcol-" + checkid.substring(7);
            columnid = checkid.substring(5);
        
            var colcells = document.getElementsByClassName(checkid);
        
            var create = true;
            if(colcells[0].classList.contains("show-column"))
            {
                create = false;
            }
        
            var toResize = [];
            var tooSmall = [];
            var shed_width = 0;
            var colList = document.getElementById("mineral-results-topbar").children;
        
            for(var i = 0; i < colList.length; i++)
            {
                if(colList[i].classList.contains("show-column") && (colList[i].id !== "mlab-"+columnid))
                {
                    toResize.push(colList[i]);
                    if(colList[i].offsetWidth < 23)
                    {
                        tooSmall.push(colList[i]);
                        shed_width += colList[i].offsetWidth - 20;
                    }
                }
            }
        
            var totalwidth = total_length(toResize);
            var z = total_length(tooSmall);
            var barwidth = document.getElementById("mineral-results-topbar").offsetWidth;
            var newWidth = 0;
        
            if(create)
            {
                for(var i = 0; i < toResize.length; i++)
                {
                    if(toResize[i].offsetWidth > 22)
                    {
                        newWidth = toResize[i].offsetWidth * ( ( ( 0.87 * barwidth ) - z + shed_width ) / ( totalwidth - z ) ); // in px
                        newWidth = Math.floor(newWidth + 0.5);
                    }
                    else
                    {
                        newWidth = 20; // in px
                    }
                    mineral_column_widths = set_mineral_column_width( toResize[i].id.substr(5), (newWidth * 100 / barwidth).toString() + '%', barwidth, visible_mineral_columns);
                }
                if(visible_mineral_columns.indexOf(columnid) === -1)
                {
                    visible_mineral_columns = push_to_list("visible_mineral_columns", columnid);
                    mineral_column_widths = push_to_list("mineral_column_widths", "0%");
                }
                mineral_column_widths = set_mineral_column_width( checkid.substr(5), '13%', barwidth, visible_mineral_columns);
            }
            else
            {
                for(var i = 0; i < toResize.length; i++)
                {
                    newWidth = ( toResize[i].offsetWidth * barwidth ) / totalwidth; // in px
                    newWidth = Math.floor(newWidth + 0.5);
                    mineral_column_widths = set_mineral_column_width( toResize[i].id.substr(5), (100 * newWidth / barwidth).toString() + '%', barwidth, visible_mineral_columns);
                }
            }
        
            for(var i = 0; i < colcells.length; i++)
            {
                colcells[i].classList.toggle("show-column");
            }
        }
        
        function toggle_collection_column(checkid)
        {
            visible_collection_columns = program_config.visible_collection_columns;
            collection_column_widths = program_config.collection_column_widths;
        
            checkid = "ccol-" + checkid.substring(7);
            columnid = checkid.substring(5);
        
            var colcells = document.getElementsByClassName(checkid);
        
            var create = true;
            if(colcells[0].classList.contains("show-column"))
            {
                create = false;
            }
        
            var toResize = [];
            var tooSmall = [];
            var shed_width = 0;
            var colList = document.getElementById("collection-results-topbar").children;
        
            for(var i = 0; i < colList.length; i++)
            {
                if(colList[i].classList.contains("show-column") && (colList[i].id !== "clab-"+columnid))
                {
                    toResize.push(colList[i]);
                    if(colList[i].offsetWidth < 23)
                    {
                        tooSmall.push(colList[i]);
                        shed_width += colList[i].offsetWidth - 20;
                    }
                }
            }
        
            var totalwidth = total_length(toResize);
            var z = total_length(tooSmall);
            var barwidth = document.getElementById("collection-results-topbar").offsetWidth;
            var newWidth = 0;
        
            if(create)
            {
                for(var i = 0; i < toResize.length; i++)
                {
                    if(toResize[i].offsetWidth > 22)
                    {
                        newWidth = toResize[i].offsetWidth * ( ( ( 0.87 * barwidth ) - z + shed_width ) / ( totalwidth - z ) ); // in px
                        newWidth = Math.floor(newWidth + 0.5);
                    }
                    else
                    {
                        newWidth = 20; // in px
                    }
                    collection_column_widths = set_collection_column_width( toResize[i].id.substr(5), (newWidth * 100 / barwidth).toString() + '%', barwidth, visible_collection_columns);
                }
                if(visible_collection_columns.indexOf(columnid) === -1)
                {
                    visible_collection_columns = push_to_list("visible_collection_columns", columnid);
                    collection_column_widths = push_to_list("collection_column_widths", "0%");
                }
                collection_column_widths = set_collection_column_width( checkid.substr(5), '13%', barwidth, visible_collection_columns);
            }
            else
            {
                for(var i = 0; i < toResize.length; i++)
                {
                    newWidth = ( toResize[i].offsetWidth * barwidth ) / totalwidth; // in px
                    newWidth = Math.floor(newWidth + 0.5);
                    collection_column_widths = set_collection_column_width( toResize[i].id.substr(5), (100 * newWidth / barwidth).toString() + '%', barwidth, visible_collection_columns);
                }
            }
        
            for(var i = 0; i < colcells.length; i++)
            {
                colcells[i].classList.toggle("show-column");
            }
        }
        
        function activate_mineral_column(col_id)
        {
            var identifier = "mcheck-" + col_id;
            document.getElementById(identifier).checked = true;
            toggle_mineral_column(identifier);
        }
        
        function activate_collection_column(col_id)
        {
            var identifier = "ccheck-" + col_id;
            document.getElementById(identifier).checked = true;
            toggle_collection_column(identifier);
        }
        
        function set_mineral_column_width(col_id, x, barwidth, visible_mineral_columns, percentages)
        {
            percentages = (typeof percentages !== 'undefined') ?  percentages : true;
            if((x.substr(-2,2) === "px") && (percentages === true))
            {
                x = parseInt(x + 1)*(100/barwidth) + "%";
            }
        
            var index = visible_mineral_columns.indexOf(col_id);
            var mineral_column_widths = modify_list("mineral_column_widths", index, x);
        
            col_id = "mcol-" + col_id;
            var column = document.getElementsByClassName(col_id);
            for(var i = 0; i < column.length; i++)
            {
                column[i].style.width = x;
                if(i === 1)
                {
                    if(column[0].offsetWidth !== column[1].offsetWidth)
                    {
                        x = column[0].offsetWidth.toString() + 'px';
                        column[1].style.width = x;
                    }
                }
            }
            return mineral_column_widths;
        }
        
        function set_collection_column_width(col_id, x, barwidth, visible_collection_columns, percentages)
        {
            percentages = (typeof percentages !== 'undefined') ?  percentages : true;
            if((x.substr(-2,2) === "px") && (percentages === true))
            {
                x = parseInt(x)*(100/barwidth) + "%";
            }
        
            var index = visible_collection_columns.indexOf(col_id);
            var collection_column_widths = modify_list("collection_column_widths", index, x);
        
            col_id = "ccol-" + col_id;
            var column = document.getElementsByClassName(col_id);
            for(var i = 0; i < column.length; i++)
            {
                column[i].style.width = x;
                if(i === 1)
                {
                    if(column[0].offsetWidth !== column[1].offsetWidth)
                    {
                        x = column[0].offsetWidth.toString() + 'px';
                        column[1].style.width = x;
                    }
                }
            }
            return collection_column_widths;
        }
        
        function change_mineral_sorting_mask()
        {
            var indicator = document.getElementById("m-name-sorting-arrow");
        
            var temp = !(program_config.minerals_results.sort_ascending);
            program_config.minerals_results.sort_ascending = temp;
        
            if( temp === true )
            {
                indicator.src = "resource/arrow_down.png";
            }
            else
            {
                indicator.src = "resource/arrow_up.png";
            }
            var resultlines = document.getElementById("mineral-result-line-container").children;
            for(var i = 0; i < resultlines.length; i++)
            {
                if(i % 2 === 1)
                {
                     resultlines[i].classList.add("result-grey-background");
                }
                else
                {
                     resultlines[i].classList.remove("result-grey-background");
                }
            }
        }
        
        function change_collection_sorting_mask(mask)
        {
            var sort_ascending = program_config.collection_results.sort_ascending;
            var sort_mask = program_config.collection_results.sort_mask;
        
            if(mask === sort_mask)
            {
                sort_ascending = !(sort_ascending);
                program_config.collection_results.sort_ascending = sort_ascending;
            }
            else
            {
                program_config.collection_results.sort_ascending = true;
                sort_ascending = true;
                program_config.collection_results.sort_mask = mask;
                sort_mask = mask;
            }
        
            var mask_names = ["name", "number", "date", "cost", "type"];
            var indicator = document.getElementById("c-"+mask_names[mask]+"-sorting-arrow");
        
            for(var i = 0; i < mask_names.length; i++)
            {
                var indicator = document.getElementById("c-"+mask_names[i]+"-sorting-arrow");
                if(i === sort_mask)
                {
                    if( sort_ascending === true )
                    {
                        indicator.src = "resource/arrow_down.png";
                    }
                    else
                    {
                        indicator.src = "resource/arrow_up.png";
                    }
                }
                else
                {
                    indicator.src = "resource/arrow_dual.png";
                }
            }
            var resultlines = document.getElementById("collection-result-line-container").children;
            for(var i = 0; i < resultlines.length; i++)
            {
                if(i % 2 === 1)
                {
                     resultlines[i].classList.add("result-grey-background");
                }
                else
                {
                     resultlines[i].classList.remove("result-grey-background");
                }
            }
        }
        function undropdown()
        {
            var dropmenu = document.getElementById("dropdown-menu");
            if(dropmenu.classList.contains('show-dropdown'))
            {
                dropmenu.classList.remove('show-dropdown');
            }
            var tabcollection = document.getElementById("collection-tab");
            if(tabcollection.classList.contains('dropdown-active'))
            {
                tabcollection.classList.remove('dropdown-active');
            }
            var droparrow = document.getElementById("dropdown-arrow-id");
            if(droparrow.classList.contains('dropdown-arrow-up'))
            {
                droparrow.classList.remove('dropdown-arrow-up');
            }
        }
        
        function dropdown()
        {
            var x = document.getElementById('dropdown-menu');
            x.classList.toggle("show-dropdown");
        
            x = document.getElementById('collection-tab');
            x.classList.toggle("dropdown-active");
        
            x = document.getElementById('dropdown-arrow-id');
            x.classList.toggle("dropdown-arrow-up");
        }
        
        function activate_mineral_table()
        {
            document.getElementById("mineral-tab").classList.add('tab-active');
            document.getElementById("collection-tab").classList.remove('tab-active');
            program_config.table = "Minerals";
            program_config.active_item_table = "Minerals";
        
            change_rightmost_panel("m-view", true);
        
            document.getElementById("collection-search-input-panel").style.display="none";
            document.getElementById("mineral-search-input-panel").style.display="inline";
        
            document.getElementById("collection-results-panel").style.display="none";
            document.getElementById("mineral-results-panel").style.display="inline";
        
            if(program_config.minerals_results.search_or)
            {
                document.getElementById("m-radio-or").checked = true;
            }
            else
            {
                document.getElementById("m-radio-and").checked = true;
            }
        }
        
        function activate_collection_table()
        {
            if(program_config.collection_table === ''){ return 1; }
        
            program_config.table = program_config.collection_table;
            program_config.active_item_table = program_config.collection_table;
        
            var tabobject = document.getElementById('collection-tab-text');
            document.getElementById("mineral-tab").classList.remove('tab-active');
            document.getElementById("collection-tab").classList.add('tab-active');
            tabobject.innerHTML = program_config.collection_table;
        
            document.getElementById("collection-search-input-panel").style.display="inline";
            document.getElementById("mineral-search-input-panel").style.display="none";
        
            document.getElementById("collection-results-panel").style.display="inline";
            document.getElementById("mineral-results-panel").style.display="none";
        
            change_rightmost_panel("c-view", true);
        
            return (' '+program_config.collection_table).slice(1);
        }
        
        function choose_new_table()
        {
            var label_list = ["name", "number", "date", "cost", "type"];
        
            for(var i = 0; i < label_list.length; i++)
            {
                if(label_list[i] === label_list[program_config.collection_results.sort_mask])
                {
                    var label = document.getElementById("clab-" + label_list[i]);
        
                    for(var j = 0; j < label.childNodes.length; j++)
                    {
                        if(label.childNodes[j].nodeType == 1)
                        {
                            if(label.childNodes[j].classList.contains("sorting-tab-arrow"))
                            {
                                break;
                            }
                        }
                    }
                    for(var k = 0; label.childNodes[j].childNodes[k].tagName !== "IMG"; k++);
        
                    if(program_config.collection_results.sort_ascending)
                    {
                        label.childNodes[j].childNodes[k].src = "resource/arrow_down.png";
                    } else {
                        label.childNodes[j].childNodes[k].src = "resource/arrow_up.png";
                    }
                }
                else
                {
                    var label = document.getElementById("clab-" + label_list[i]);
        
        
                    for(var j = 0; j < label.childNodes.length; j++)
                    {
                        if(label.childNodes[j].nodeType == 1)
                        {
                            if(label.childNodes[j].classList.contains("sorting-tab-arrow"))
                            {
                                break;
                            }
                        }
                    }
                    for(var k = 0; label.childNodes[j].childNodes[k].tagName !== "IMG"; k++);
        
                    label.childNodes[j].childNodes[k].src = "resource/arrow_dual.png";
                }
            }
        
            if(program_config.collection_results.search_or)
            {
                document.getElementById("c-radio-or").checked = true;
            }
            else
            {
                document.getElementById("c-radio-and").checked = true;
            }
        
            var radiolist = document.getElementsByName("datecomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.datecomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
            var radiolist = document.getElementsByName("numcomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.numcomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
            var radiolist = document.getElementsByName("costcomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.costcomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
        
            ui.arbitrary_js("activate_collection_table");
            display_collection_item();
        }
        
        function clear_mineral_form()
        {
            var form = document.getElementById("mineral-search-form");
            var fields = ["main", "name", "variety", "colours", "description", "structure", "composition", "category"];
        
            for(var i = 0; i < fields.length; i++)
            {
                form.elements[fields[i]+"-search"].value = '';
            }
        }
        
        function clear_collection_form()
        {
            var form = document.getElementById("collection-search-form");
            var fields = ["main", "name", "purchase-num", "date-day", "date-month", "date-year", "cost", "mineral", "colour", "description", "notes", "purchase", "location", "buyer"];
        
            for(var i = 0; i < fields.length; i++)
            {
                form.elements[fields[i]+"-search"].value = '';
            }
        }
        
        function search_collection_db()
        {
            var search_terms = new CollectionEntry();
        
            var search_form = document.getElementById("collection-search-form");
            var main_search = search_form.elements["main-search"].value;
            search_form.elements["date-day-search"].style.boxShadow = "none";
            search_form.elements["date-month-search"].style.boxShadow = "none";
            search_form.elements["date-year-search"].style.boxShadow = "none";
        
            // fill search_terms with data
            search_terms.number        = parseNum( search_form.elements["purchase-num-search"].value );
            search_terms.name          =           search_form.elements["name-search"].value;
            search_terms.type          =  explode( search_form.elements["mineral-search"].value, ',' );
            search_terms.description   =           search_form.elements["description-search"].value;
            search_terms.colours       =  explode( search_form.elements["colour-search"].value, ',' );
            search_terms.purchaseplace =           search_form.elements["purchase-search"].value;
            search_terms.notes         =           search_form.elements["notes-search"].value;
            search_terms.cost          = parseNum( search_form.elements["cost-search"].value );
            search_terms.buyer         =           search_form.elements["buyer-search"].value;
            search_terms.location      =           search_form.elements["location-search"].value;
        
            var modified_date = make_date_acceptable(search_form);
            if( modified_date === 0 )
            {
                status("Malformed date - should be in the form dd-mm-yyyy", true);
                search_form.elements["date-day-search"].style.boxShadow = "inset 0px 0px 4px red";
                search_form.elements["date-month-search"].style.boxShadow = "inset 0px 0px 4px red";
                search_form.elements["date-year-search"].style.boxShadow = "inset 0px 0px 4px red";
                return false;
            }
            search_terms.date = modified_date;
        
            return [search_terms, main_search];
        }
        
        function search_mineral_db()
        {
            var search_terms = new MineralEntry();
        
            var search_form = document.getElementById("mineral-search-form");
            var main_search = search_form.elements["main-search"].value;
        
            // fill search_terms with data
            search_terms.name        =         search_form.elements["name-search"].value;
            search_terms.varieties   = explode(search_form.elements["variety-search"].value, ',');
            search_terms.description =         search_form.elements["description-search"].value;
            search_terms.colours     = explode(search_form.elements["colours-search"].value, ',');
            search_terms.structure   =         search_form.elements["structure-search"].value;
            search_terms.category    =         search_form.elements["category-search"].value;
            search_terms.composition =         search_form.elements["composition-search"].value;
        
            return [search_terms, main_search];
        }
        
        function create_new_table(name)
        {
            choose_new_table(program_config.table);
        
            var existing_tables = [];
            var dropdown = document.getElementById("dropdown-menu").children;
            for(var i = 0; i < dropdown.length; i++)
            {
                if( dropdown[i].classList.contains("dropdown-table-button") )
                {
                    existing_tables.push(dropdown[i].id);
                }
            }
            for(var j = 0; j < program_config.collection_table_list.length; j++)
            {
                if( existing_tables.indexOf(program_config.collection_table_list[j]) === -1 )
                {
                    add_new_table( program_config.collection_table_list[j] );
                }
            }
            remove_collection_results();
            display_collection_item();
        
            status("Table '"+name+"' created");
        }
        
        function confirm_delete_table(tablename)
        {
            if(!(event == null)) // if this originated from a click event
            {
                event.stopPropagation();
                undropdown();
            }
            ui.confirm("Are you sure you want to delete the table '"+tablename+"'?", "continue_delete_table", [tablename]);
        }
        
        function continue_delete_table(tablename)
        {
            ui.continue_delete_table(tablename);
        }
        
        function remove_table(tablename, prev_table)
        {
            status("Starting delete");
            var tables = document.getElementById("dropdown-menu").children;
        
            for(var i = 0; i < tables.length; i++)
            {
                if((tables[i].id === "dropdown-divider") || (tables[i].id === '') )
                {
                    continue;
                }
                var pos = program_config.collection_table_list.indexOf(tables[i].id);
                if( pos === -1 )
                {
                    tables[i].parentNode.removeChild(tables[i]);
                }
            }
        
            if(prev_table === "Minerals")
            {
                document.getElementById("collection-tab-text").innerHTML = program_config.collection_table;
            }
            else if(program_config.table === "Minerals")
            {
                activate_mineral_table();
            }
            else
            {
                ui.arbitrary_js("choose_new_table");
                if(prev_table !== program_config.table)
                {
                    ui.add_collection_items();
                }
            }
        
            if(program_config.collection_table_list.length === 0)
            {
                document.getElementById("collection-tab-text").innerHTML = '[ none ]';
            }
        
            status("Table '"+tablename+"' deleted");
            return "done";
        }
        function add_new_table(label)
        {
            // adds a new item to the collection table dropdown menu
            var newItem = document.createElement("DIV");
            var textNode = document.createTextNode(label);
            newItem.id = label; // this is the name of the table
            newItem.classList.add("dropdown-table-button")
            newItem.onclick = function() { ui.choose_new_table(this.id); }
        
            newItem.appendChild(textNode);
        
            var rm_button = document.createElement("A");
            rm_button.classList.add("remove-button");
            rm_button.onclick = function() { confirm_delete_table(this.parentElement.id); }
        
            newItem.appendChild(rm_button);
        
            var dividerElem = document.getElementById("dropdown-divider");
            document.getElementById("dropdown-menu").insertBefore(newItem, dividerElem);
        }
        
        function apply_config()
        {
            var collection_table = program_config.collection_table;
        
            if((program_config.collection_table == '') && (program_config.collection_table_list.length > 0))
            {
                collection_table = program_config.collection_table_list[0]
                program_config.collection_table = collection_table;
            }
            if(collection_table !== '')
            {
                document.getElementById("collection-tab-text").innerHTML = program_config.collection_table;
            }
            else
            {
                document.getElementById("collection-tab-text").innerHTML = '[ none ]';
            }
        
            for(var i = 0; i < program_config.collection_table_list.length; i++)
            {
                add_new_table(program_config.collection_table_list[i]);
            }
        
            // activate result columns
            var col_col_widths = program_config.collection_column_widths.slice(0);
            var min_col_widths = program_config.mineral_column_widths.slice(0);
            for(var i = 0; i < program_config.visible_collection_columns.length; i++)
            {
                activate_collection_column(program_config.visible_collection_columns[i]);
            }
            for(var i = 0; i < program_config.visible_mineral_columns.length; i++)
            {
                activate_mineral_column(program_config.visible_mineral_columns[i]);
            }
        
            // set result column widths
            var barwidth = document.getElementById("mineral-results-topbar").offsetWidth;
            for(var i = 0; i < program_config.visible_collection_columns.length; i++)
            {
                set_collection_column_width(program_config.visible_collection_columns[i], col_col_widths[i], barwidth, visible_collection_columns);
            }
            for(var i = 0; i < program_config.visible_mineral_columns.length; i++)
            {
                set_mineral_column_width(program_config.visible_mineral_columns[i], min_col_widths[i], barwidth, visible_mineral_columns);
            }
        
            if(program_config.table === 'Minerals')
            {
                activate_mineral_table();
            }
            else
            {
                choose_new_table(program_config.table);
                activate_collection_table();
            }
        
            if(program_config.active_item_table === 'Minerals')
            {
                change_rightmost_panel("m-view", true);
            }
            else
            {
                change_rightmost_panel("c-view", true);
            }
            var label_list = ["name", "number", "date", "cost", "type"];
        
            for(var i = 0; i < label_list.length; i++)
            {
                if(label_list[i] === label_list[program_config.collection_results.sort_mask])
                {
                    var label = document.getElementById("clab-" + label_list[i]);
        
                    for(var j = 0; j < label.childNodes.length; j++)
                    {
                        if(label.childNodes[j].nodeType == 1)
                        {
                            if(label.childNodes[j].classList.contains("sorting-tab-arrow"))
                            {
                                break;
                            }
                        }
                    }
                    for(var k = 0; label.childNodes[j].childNodes[k].tagName !== "IMG"; k++);
        
                    if(program_config.collection_results.sort_ascending)
                    {
                        label.childNodes[j].childNodes[k].src = "resource/arrow_down.png";
                    } else {
                        label.childNodes[j].childNodes[k].src = "resource/arrow_up.png";
                    }
                }
                else
                {
                    var label = document.getElementById("clab-" + label_list[i]);
        
        
                    for(var j = 0; j < label.childNodes.length; j++)
                    {
                        if(label.childNodes[j].nodeType == 1)
                        {
                            if(label.childNodes[j].classList.contains("sorting-tab-arrow"))
                            {
                                break;
                            }
                        }
                    }
                    for(var k = 0; label.childNodes[j].childNodes[k].tagName !== "IMG"; k++);
        
                    label.childNodes[j].childNodes[k].src = "resource/arrow_dual.png";
                }
            }
        
            if(program_config.collection_results.search_or)
            {
                document.getElementById("c-radio-or").checked = true;
            }
            else
            {
                document.getElementById("c-radio-and").checked = true;
            }
        
            var radiolist = document.getElementsByName("datecomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.datecomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
            var radiolist = document.getElementsByName("numcomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.numcomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
            var radiolist = document.getElementsByName("costcomp");
            for(var i = 0; i < radiolist.length; i++)
            {
                if(parseInt(radiolist[i].value, 10) === program_config.collection_results.costcomp)
                {
                    radiolist[i].checked = true;
                }
            }
        
            var mask_names = ["name", "number", "date", "cost", "type"];
        
            for(var i = 0; i < mask_names.length; i++)
            {
                var indicator = document.getElementById("c-"+mask_names[i]+"-sorting-arrow");
                if(i === program_config.collection_results.sort_mask)
                {
                    if( program_config.collection_results.sort_ascending === true )
                    {
                        indicator.src = "resource/arrow_down.png";
                    }
                    else
                    {
                        indicator.src = "resource/arrow_up.png";
                    }
                }
                else
                {
                    indicator.src = "resource/arrow_dual.png";
                }
            }
        
            if( program_config.minerals_results.sort_ascending === true )
            {
                document.getElementById("m-name-sorting-arrow").src = "resource/arrow_down.png";
            }
            else
            {
                document.getElementById("m-name-sorting-arrow").src = "resource/arrow_up.png";
            }
            return 0;
        }
        
        function poke_images()
        {
            // the reason for these calls is beyond my ability to fathom
            // if these functions are not called, the image for the image removal button will not load
            // if they are called the image is found fine, even if NOTHING IS ADDED
            // this is just ridiculous and I don't understand it
            add_mineral_image_path("", true);
            add_collection_image_path("", true);
        
            var arrow = document.getElementById("collection-image-arrow-left");
            arrow.src = "resource/arrow_left_null.png";
            arrow.src = "resource/arrow_left.png";
            arrow = document.getElementById("collection-image-arrow-right");
            arrow.src = "resource/arrow_right_null.png";
            arrow.src = "resource/arrow_right.png";
            arrow = document.getElementById("mineral-image-arrow-left");
            arrow.src = "resource/arrow_left_null.png";
            arrow.src = "resource/arrow_left.png";
            arrow = document.getElementById("mineral-image-arrow-right");
            arrow.src = "resource/arrow_right_null.png";
            arrow.src = "resource/arrow_right.png";
        
        }
        
        function validate_column_widths()
        {
            var barwidth = document.getElementById("mineral-results-topbar").offsetWidth;
            for(var i = 0; i < program_config.visible_collection_columns.length; i++)
            {
                var column = document.getElementsByClassName("ccol-" + program_config.visible_collection_columns[i]);
                if(column.length > 1)
                {
                    if(column[0].offsetWidth !== column[1].offsetWidth)
                    {
                        var x = column[0].offsetWidth.toString() + 'px';
                        set_collection_column_width(program_config.visible_collection_columns[i], x, barwidth, visible_collection_columns, false);
                    }
                }
            }
            for(var i = 0; i < program_config.visible_mineral_columns.length; i++)
            {
                var column = document.getElementsByClassName("mcol-" + program_config.visible_mineral_columns[i]);
                if(column.length > 1)
                {
                    if(column[0].offsetWidth !== column[1].offsetWidth)
                    {
                        var x = column[0].offsetWidth.toString() + 'px';
                        set_mineral_column_width(program_config.visible_mineral_columns[i], x, barwidth, visible_mineral_columns, false);
                    }
                }
            }
        }
        
        function startup_probe()
        {
            return [1, program_config.table];
        }
        
        function init()
        {
            status("Loading program configuration...");
            var a;
        
            attach_drag_handlers(); // add column resize event listeners
            add_context_listeners(); // add listeners for column context menu
        
            // make text in editing boxes editable
            var linelist = document.getElementsByClassName('edit-input');
            for(var i = 0; i < linelist.length; i++)
            {
                linelist[i].contentEditable = 'true';
            }
        
            poke_images();
        
            apply_config();
        
            display_mineral_item();
            display_collection_item();
        
            if(program_config.table === "Minerals")
            {
                a = ui.add_mineral_items();
                a = ui.add_collection_items();
            }
            else
            {
                a = ui.add_collection_items();
                a = ui.add_mineral_items();
            }
        
            status("Ready");
            return 0;
        }
        function empty_return(str) { return str; }
        
        function seperate_commas(str) { return explode(str, ","); }
        
        function seperate_images(str) { return explode(str, "\x1c"); }
        
        function to_integer(str) { return parseInt(str, 10); }
        
        function to_boolean(str) { return (str === "1"); }
        
        function to_integer_list(str)
        {
            var values = explode(str, ",");
            for(var i = 0; i < values.length; i++)
            {
                values[i] = parseInt(values[i], 10);
            }
        }
        
        function apply_synced_config(data, mode)
        {
            // program_config.alternate_table_info isn't actually used on the JS side, so isn't synced
            var conversion = ["empty_return", "seperate_commas", "to_integer", "to_integer_list", "seperate_images", "to_boolean"];
            var item = 0;
            var properties = [];
            var conversion_code = [];
            var second_level = "";
            var temp = "";
        
            if(mode === "program_config")
            {
                properties = ["table", "collection_table", "collection_table_list", "active_item_table",
                              "collection_current_image", "mineral_current_image", "visible_collection_columns",
                              "collection_column_widths", "visible_mineral_columns", "mineral_column_widths",
                              "image_path"];
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [0, 0, 1, 0, 2, 2, 1, 1, 1, 1, 0];
            }
            else if(mode === "program_config.collection_results")
            {
                properties = ["tablename", "results", "active_item", "sort_mask",
                              "sort_ascending", "search_or", "datecomp", "costcomp", "numcomp"];
                second_level = "collection_results";
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images, 5 = boolean
                conversion_code = [0, 3, 2, 2, 5, 5, 2, 2, 2];
            }
            else if(mode === "program_config.minerals_results")
            {
                properties = ["tablename", "results", "active_item", "sort_mask", "sort_ascending", "search_or"];
                second_level = "minerals_results";
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [0, 3, 2, 2, 5, 5];
            }
            else if(mode === "program_config.active_collection_item")
            {
                properties = ["rowid", "number", "cost", "texture", "order", "name", "description", "date",
                              "buyer", "notes", "purchaseplace", "location", "type", "images", "colours"];
                second_level = "active_collection_item";
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 4, 1];
            }
            else if(mode === "program_config.active_mineral_item")
            {
                properties = ["rowid", "pagenumber", "category", "name", "description", "structure",
                              "composition", "varieties", "colours", "images"];
                second_level = "active_mineral_item";
                // 0 = nothing, 1 = list of strings, 2 = int, 3 = list of ints, 4 = list of images
                conversion_code = [2, 2, 0, 0, 0, 0, 0, 1, 1, 4];
            }
        
            for(var i = 0; i < data.length; i++)
            {
                if(String(data[i]) === String.fromCharCode(0x1E))
                {
                    if(second_level === "")
                    {
                        program_config[properties[item]] = window[conversion[conversion_code[item]]](temp);
                    }
                    else
                    {
                        program_config[second_level][properties[item]] = window[conversion[conversion_code[item]]](temp);
                    }
                    temp = '';
                    item++;
                }
                else
                {
                    temp += data[i];
                }
            }
            if(second_level === "")
            {
                program_config[properties[item]] = window[conversion[conversion_code[item]]](temp);
            }
            else
            {
                program_config[second_level][properties[item]] = window[conversion[conversion_code[item]]](temp);
            }
        }
        
        function apply_synced_config_legacy(data, mode)
        {
            switch(mode)
            {
                case "program_config":
                    program_config.table = data[0];
                    program_config.collection_table = data[1];
                    program_config.collection_table_list = data[2];
                    program_config.active_item_table = data[3];
                    program_config.collection_current_image = data[4];
                    program_config.mineral_current_image = data[5];
                    program_config.visible_collection_columns = data[6];
                    program_config.collection_column_widths = data[7];
                    program_config.visible_mineral_columns = data[8];
                    program_config.mineral_column_widths = data[9];
                    program_config.image_path = data[10];
                    break;
                case "program_config.collection_results":
                    program_config.collection_results.tablename = data[0];
                    program_config.collection_results.results = data[1];
                    program_config.collection_results.active_item = data[2];
                    program_config.collection_results.sort_mask = data[3];
                    program_config.collection_results.sort_ascending = data[4];
                    program_config.collection_results.search_or = data[5];
                    program_config.collection_results.datecomp = data[6];
                    program_config.collection_results.costcomp = data[7];
                    program_config.collection_results.numcomp = data[8];
                    break;
                case "program_config.minerals_results":
                    program_config.minerals_results.tablename = data[0];
                    program_config.minerals_results.results = data[1];
                    program_config.minerals_results.active_item = data[2];
                    program_config.minerals_results.sort_mask = data[3];
                    program_config.minerals_results.sort_ascending = data[4];
                    program_config.minerals_results.search_or = data[5];
                    break;
                case "program_config.active_collection_item":
                    program_config.active_collection_item.rowid = data[0];
                    program_config.active_collection_item.number = data[1];
                    program_config.active_collection_item.cost = data[2];
                    program_config.active_collection_item.texture = data[3];
                    program_config.active_collection_item.order = data[4];
                    program_config.active_collection_item.name = data[5];
                    program_config.active_collection_item.description = data[6];
                    program_config.active_collection_item.date = data[7];
                    program_config.active_collection_item.buyer = data[8];
                    program_config.active_collection_item.notes = data[9];
                    program_config.active_collection_item.purchaseplace = data[10];
                    program_config.active_collection_item.location = data[11];
                    program_config.active_collection_item.type = data[12];
                    program_config.active_collection_item.images = data[13];
                    program_config.active_collection_item.colours = data[14];
                    break;
                case "program_config.active_mineral_item":
                    program_config.active_mineral_item.rowid = data[0];
                    program_config.active_mineral_item.pagenumber = data[1];
                    program_config.active_mineral_item.category = data[2];
                    program_config.active_mineral_item.name = data[3];
                    program_config.active_mineral_item.description = data[4];
                    program_config.active_mineral_item.structure = data[5];
                    program_config.active_mineral_item.composition = data[6];
                    program_config.active_mineral_item.varieties = data[7];
                    program_config.active_mineral_item.colours = data[8];
                    program_config.active_mineral_item.images = data[9];
                    break;
            }
        }
    </script>
</body>
</html>
